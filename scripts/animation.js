/*

  Animation.io is the animation framework by Mehreinfach.
  This version was assembled Thursday, January 9th, 2014, 13:40:14 GMT.

  * Use Animation.io offline: http://academy.mehreinfach.de/hc/de/articles/201023386
  * Meet Mehreinfach, the people behind Animation.io: http://mehreinfach.de
  * Get notified about upcoming animation workshops: http://mehreinfach.de/newsletter

*/


function Animation(a){var b=this;if(!a)throw"The Animation()-constructor requires options to be passed.";if(!a.width)throw"Animation() needs width";if(!a.height)throw"Animation() needs height";b.width=a.width,b.height=a.height,b.loadedScenes=[],b.firstSceneName=a.firstSceneName||"scene0",config(b),b.stageDiv=AnimationIO.dom.createDiv("stage","stage"),setDivSize(b.stageDiv,b.width,b.height),b.startedLoadingAt=now(),b.dimensions={x:b.width,y:b.height},b.textIsDisplaying=!0;var c=document.getElementsByTagName("script");return b.domainName=AnimationIO.helper.domainFromURL(c[c.length-1].src),b}function loadAnimationInto(a,b,c,d,e){if(!a)throw"Please give your animation a title as 1st parameter.";if(!b)throw"Please set your animation's wrapper-div-ID as 2nd loading-parameter.";if(!d)throw"Please set your animation's width in pixels as 4th loading-parameter.";if(!e)throw"Please set your animation's width in pixels as 5th loading-parameter.";var f=document.getElementById(b);if(!f)throw'Cannot find a div with ID "'+b+"' to load animation into.";if(!c)throw"Please set ID of first sceneas 3rd loading-parameter.";localStorage.getItem("scene")&&window[localStorage.getItem("scene")]&&(c=localStorage.getItem("scene"));var g=parseInt(window.location.hash.substring(1),10);isNaN(g)||(c="scene"+g),getOrCreateIdentity();var h=AnimationIO.dom.createDiv("animation_target_div","");if(f.appendChild(h),window.onload)var i=window.onload;return window.onload=function(){i&&i(),AnimationIO.coreAnimationLoader(h,f,c,d,e)},h}function createDiv(a,b){return console.warn("createDiv() is deprecated, please use AnimationIO.dom.createDiv()"),AnimationIO.dom.createDiv(a,b)}function paramOrVariable(a,b,c,d){return"object"==typeof a&&"undefined"!=typeof a[b]?a[b]:"undefined"!=typeof c?c:"undefined"!=typeof d?d:void 0}function onLocalhost(){return/localhost/.exec(window.location.hostname)?!0:!1}function sameprefix(a,b){return 0>a?-Math.abs(b):Math.abs(b)}function relativeOrAbsolutePath(a,b){return/^https?:\/\//.exec(b.toLowerCase())?b:a+b}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function easeOut(a,b,c,d){return a/=d,a--,c*(a*a*a+1)+b}function randomId(){return"id"+Math.floor(1e4*Math.random())+Date.now()}function getParameterFromUrlByName(a){a=a.replace(/[\[]/,"\\\\[").replace(/[\]]/,"\\\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function distance(a,b,c,d){return Math.abs(Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)))}function vector(a,b,c,d){var e=distance(a,b,c,d);return{x:(c-a)/e,y:(d-b)/e,distance:e}}function now(){return(new Date).getTime()}function timeInMinutes(a){return console.log("DEPRECATION-WARNING: timeInMinutes() is deprecated, please use minutesToMilliseconds()"),minutesToMilliseconds(a)}function minutesToMilliseconds(a){return 1e3*a*60}function seconds(){return parseInt(now()/1e3,10)}function isNumeric(a){return!notNumeric(a)}function notNumeric(a){return"undefined"==typeof a||isNaN(parseFloat(a))||!isFinite(a)}function round(a,b){return 0>b&&(b=0),this.q=Math.pow(10,b),Math.round(a*this.q)/this.q}function cutOffPx(a){var b=a.length;return parseFloat(a.toString().substring(0,b-2))}function t(){return now()}function browserCompatible(){try{{new Audio}return!0}catch(a){return!1}}function minutesToTime(a){return 60*a*1e3}function getIntegerFromEndOfString(a){return parseInt(a.match(/\d+$/)[0],10)}function setDivSize(a,b,c){a.style.width=b+"px",a.style.height=c+"px"}function dowhen(theAction,conditionAsString,tryAgainIn,doAnywayAfter){eval(conditionAsString)||0>=doAnywayAfter?theAction():window.setTimeout(function(){dowhen(theAction,conditionAsString,tryAgainIn,doAnywayAfter-tryAgainIn)},tryAgainIn)}function pluralize(a,b,c,d){return 0===a?b.replace("%count%",0):1===a?c.replace("%count%",1):d.replace("%count%",AnimationIO.helper.integerValueOfOr(a,0))}function rotateXaroundOriginByAngle(a,b,c,d,e){return c+Math.cos(e)*(a-c)-Math.sin(e)*(b-d)}function rotateYaroundOriginByAngle(a,b,c,d,e){return d+Math.sin(e)*(a-c)+Math.cos(e)*(b-d)}function logActors(){for(var a=0;a<window.animation.currentScene.actors.length;a++)console.log(""+a+": "+window.animation.currentScene.actors[a].filename)}function logActorsSorted(){for(var a=[],b=0;b<window.animation.currentScene.actors.length;b++)a.push(window.animation.currentScene.actors[b].filename+": "+b);a.sort();for(var c=0;c<a.length;c++)console.log(a[c])}function actor(a){return console.log(window.animation.currentScene.actors[a].filename),window.animation.currentScene.actors[a]}function Actor(a,b,c,d){this.startAnimationTimestamp=now(),this.actortype="actortemplate",this.startPosition={x:a,y:b},this.vector={x:0,y:0},this.startX=a,this.startY=b,this.originalOpacity=1,this.currentOpacity=1,this.currentlyVisible=!0,this.initiallyVisible=!0,this.sizeX=c,this.sizeY=d,this.imagesizeX=this.sizeX,this.imagesizeY=this.sizeY,this.rotationCenterX=this.sizeX?this.sizeX/2:0,this.rotationCenterY=this.sizeY?this.sizeY/2:0,this.spin=0,this.offsetX=0,this.offsetY=0,this.zeroOffsX=0,this.zeroOffsY=0,this.needsMoving=!1,this.defaultdirectory="",this.tilt=0,this.behaviors=[],this.reactions=[],this.reactionTargets=[],this.source="",this.phases=[],this.oldPhase=0,this.phaseCycle=1e3,this.phaseCycling=!0,this.cyclesOnce=!1,this.startedCyclingOnceAt=!1,this.comesBack=!1,this.waitingForReset=!1,this.waitingForResetSince=null,this.lastVisibilityCheckInSeconds=now(),this.originaldelay=0,this.delay=0,this.zIndex=0,this.scene=null,this.enteredAt=null,this.addClass=function(a){return this.image.className+=" "+a,this},this.hasId=function(a){this.image.setAttribute("id",a)},this.setSize=function(a,b){this.image.style.zIndex=this.actualZIndex(),this.imagesize={x:a,y:b},this.image.style.width=a+"px",this.image.style.height=b+"px"},this.flipHorizontal=function(){return this.flippinghorizontally=!0,this},this.flipVertical=function(){return this.flippinghorizontally=!0,this},this.enter=function(a){this.image.style.zIndex=this.overrideZIndex?10*(this.scene.actors.length+1)+this.overrideZIndexExtraValue:this.zIndex,a.div.appendChild(this.image),this.enteredAt=now()}}function moveActor(a){a.position.x+=a.vector.x,a.position.y+=a.vector.y,a.image.style.left=a.absolutePositionTopLeftX()+"px",a.image.style.top=a.absolutePositionTopLeftY()+"px",a.lastVector=a.vector,a.vector={x:0,y:0},a.needsMoving=!1}function tiltActor(a){a.tilt=(a.tilt+a.spin)%360,a.image.style.transformOrigin=a.rotationCenterX+"px "+a.rotationCenterY+"px",a.image.style.webkitTransformOrigin=a.rotationCenterX+"px "+a.rotationCenterY+"px",a.image.style.msTransformOrigin=a.rotationCenterX+"px "+a.rotationCenterY+"px",a.image.style.transform="rotate("+a.tilt+"deg)",a.image.style.webkitTransform="rotate("+a.tilt+"deg)",a.image.style.msTransform="rotate("+a.tilt+"deg)",a.spin=0}function animateactor(a){if(a.currentlyVisible||(a.image.style.visibility="hidden"),a.comesBack&&notVisibleOnStage(a))a.waitingForReset?t()-a.waitingForResetSince>=a.resetDelay&&(a.reset(),a.waitingForReset=!1):a.comesBack&&(a.alterOpacity(0),a.waitingForReset=!0,a.waitingForResetSince=t());else if(a.delay>0&&!a.finishedDelaying)null===a.startedDelayingAt?a.startedDelayingAt=t():t()>=a.startedDelayingAt+a.delay&&(a.finishedDelaying=!0);else{a.phases.length>1&&(a.cyclesOnce||a.phaseCycling)&&(a.cyclesOnce&&!a.startedCyclingOnceAt&&(a.startedCyclingOnceAt=now()),a.currentPhase()!==a.oldPhase&&(a.image.src=a.phases[a.currentPhase()],a.oldPhase=a.currentPhase(),a.currentPhase()+1===a.phases.length&&(a.cyclesOnce&&(console.log("*****************1"),console.log(a.startedCyclingOnceAt),console.log("*****************")),a.cyclesOnce=!1,a.startedCyclingOnceAt=!1)));for(var b=0;b<a.behaviors.length;b++)a.behaviors[b].done||a.behaviors[b].applybehavior();(a.needsMoving||0!==a.vector.x||0!==a.vector.y)&&moveActor(a),(0!==a.spin||0!==a.tilt)&&tiltActor(a),a.showsCorners&&a.updateCorners()}}function redDot(a,b,c,d){return a.createActor(a.animation.domainName+"images/reddot.png",b-4,c-4,10,10).isInLayer(d).isOnTop()}function fadeIn(a,b){(notNumeric(a.style.opacity)||a.style.opacity<0)&&(a.style.opacity=0),notNumeric(b)&&(b=1e3),prepareFade(a,b,1)}function fadeOut(a,b){(notNumeric(a.style.opacity)||a.style.opacity>1)&&(a.style.opacity=1),notNumeric(b)&&(b=1e3),prepareFade(a,b,0)}function executeFadeInTimeoutLoop(a,b,c,d,e,f){var g=c-b,h=g/(d/e),i=b+h;i>1||0>i?a.style.opacity=c:(a.style.opacity=i,setTimeout(function(){executeFadeInTimeoutLoop(a,i,c,d-f,e,f)},f))}function prepareFade(a,b,c){var d=parseFloat(a.style.opacity),e=30,f=1e3/e;executeFadeInTimeoutLoop(a,d,c,b,e,f)}function setVisible(a,b){return console.warn("setVisible(actor) is deprecated, please use actor.setVisible(newOpacity[default = 1])"),a.setVisible(b)}function syncVisibleByKey(a){updateKey(a+"-visibleForever",!0),updateKey(a+"-invisibleForever",!1)}function setVisibleAndSync(a,b){return a.setVisible(b),a.syncs()?a.setVisibleForever():console.error("You are trying to sync "+a.filename+" but have not set a synckey! Use setSynckey()…"),a}function setInvisible(a){a.setInvisible(),console.warn("setInvisible(actor) is deprecated, please use actor.setInvisible()")}function syncInvisibleByKey(a){updateKey(a+"-invisibleForever",!0),updateKey(a+"-visibleForever",!1)}function setInvisibleAndSync(a){return a.setInvisible(),a.syncs()?a.setInvisibleForever():console.error("You are trying to sync "+a.filename+" but have not set a synckey! Use setSynckey()…"),a}function notVisibleOnStage(a){return a.position.x>a.scene.dimensions.x||a.position.x+a.imagesize.x<0||a.position.y+a.imagesize.y<0||a.position.y>a.scene.dimensions.y}function visibleOnStage(){return!notVisibleOnStage}function Scene(a){var b=this;if("object"!=typeof a)throw'Please use new format for creating scenes, e.g. like this: {"animation": animation, "id": "scene0", "title": "sometitle", "width": 1000, "height": 700}';if(!a.id)throw"Please set an ID for scene.";return b.id=a.id,b.title=a.title||a.id,b.div=AnimationIO.dom.createDiv(a.id,"scene"),b.animation=a.animation,b.syncs=!AnimationIO.helper.truth(a.syncs),b.isVisible=!1,b.actors=[],b.texts=[],b.textDisplaying=!0,b.alwaysShowsText=!1,b.displayedAt=Date.now(),scrollingPerspectiveStrength="undefined",b.scrollPositionX=0,b.scrollPositionY=0,b.scrollPositionVectorX=0,b.scrollPositionVectorY=0,b.dimensions={},b.dimensions.x="undefined"!=typeof a.width?parseInt(a.width,10):0,b.dimensions.y="undefined"!=typeof a.height?parseInt(a.height,10):0,b.currentZIndex=0,b.addActor=function(a){a.zIndex=b.currentZIndex+=10,b.actors.push(a)},b.setDivSizeToStage=function(){setDivSize(b.div,b.animation.width,b.animation.height)},b.age=function(){return Date.now()-b.displayedAt},b.alwaysShowText=function(){b.alwaysShowsText=!0},b.url=function(){var a="";return a+=window.location.protocol,a+="//",a+=window.location.hostname,a+=window.location.pathname,a+="#"+b.id.match(/\d+$/)[0]},b.preloadSceneIds=[a.id],b.removeBehaviorsThatCameFromReacts=function(){for(var a=b.actors.length-1;a>=0;a--)try{b.actors[a].removeBehaviorsThatCameFromReacts()}catch(c){}},b.makeVisible=function(){b.div.style.display="block",b.isVisible=!0},b.makeInvisible=function(){b.div.style.display="none",b.isInvisible=!1,b.removeBehaviorsThatCameFromReacts()},b.makeInvisible(),b.cleanup=function(){console.log('cleaning up "'+b.id+'"');for(var a=b.actors.length-1;a>=0;a--)b.actors[a].cleanupBehaviors();b.createActor("blank.png",0,0,0,0).scrollsTo(0,0,1e3)},b.makeOthersInvisible=function(){for(var a=b.animation.textIsDisplaying,c=b.animation.loadedScenes.length-1;c>=0;c--)b.animation.loadedScenes[c].id.match(b.id)?b.makeVisible():(b.animation.loadedScenes[c].makeInvisible(),b.animation.loadedScenes[c].hideText());a||b.alwaysShowsText?b.showText():b.hideText(),b.animation.textIsDisplaying=a},b.enterActors=function(){for(var a=0;a<b.actors.length;a++)b.actors[a].enter(b)},b.write=function(a,c,d,e){var f=document.createElement("div");f.innerHTML=d,f.setAttribute("class","text "+("undefined"==typeof e?"":e)),f.style.left=a+"px",f.style.top=c+"px",b.div.appendChild(f),b.texts.push(f)},b.showText=function(){b.textDisplaying=!0;for(var a=b.texts.length-1;a>=0;a--)b.texts[a].style.visibility="visible";b.animation.textIsDisplaying=!0},b.hideText=function(){b.textDisplaying=!1;for(var a=b.texts.length-1;a>=0;a--)b.texts[a].style.visibility="hidden";b.animation.textIsDisplaying=!1},b}function ismobile(){return!1||null!==navigator.userAgent.match(/iPad/i)||null!==navigator.userAgent.match(/iPhone/i)||null!==navigator.userAgent.match(/iPod/i)||null!==navigator.userAgent.match(/Android/i)||null!==navigator.userAgent.match(/IEMobile/i)}function Plugin(a,b,c,d,e){this.actor=paramOrVariable(a,"actor",c),this.delay=paramOrVariable(a,"delay",a),this.triggeredByAction=AnimationIO.helper.truth(paramOrVariable(a,"triggeredByAction",d)),this.easeIn="undefined"!=typeof b?b:0,this.needsToCalculateEasein=this.easeIn>0,this.startAnimationTimestamp=new Date,this.sync=!1,this.done=!1,this.running=!1,this.plugintype=!1;return this.setup=function(){this.targetObject=isNumeric(e)?c.reactionTargets[e]:c},this.setup(),this.resetStartAnimationTimestamp=function(){this.startAnimationTimestamp=now()},this.applybehavior=function(){},this.resetPlugin=function(){this.done=!1,this.resetStartAnimationTimestamp(),this.needsToCalculateEasein=this.easeIn>0},this.isDoneWhen=function(a,b){this.done=a,"undefined"!=typeof b&&a&&b(this)},this.reset=function(){this.resetPlugin()},this.cleanupPlugin=function(){},this.cleanup=function(){this.cleanupPlugin()},this.age=function(){return new Date-this.startAnimationTimestamp},this.factor=function(){return this.needsToCalculateEasein&&this.easeIn>0&&this.age()<this.easeIn?Math.cos(this.age()/this.easeIn*(Math.PI/2)-Math.PI/2):(this.needsToCalculateEasein=!1,1)},this}function bindEvent(a,b,c,d){"undefined"!=typeof d&&(d=null),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function unbindEvent(){this.removeEventListener("click",arguments.callee,!1)}function handleClick(a){var b,c;a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var d=document.getElementById("animframe");animframeX=d.offsetLeft-d.scrollLeft+d.clientLeft,animframeY=d.offsetTop-d.scrollTop+d.clientTop,b-=animframeX,c-=animframeY,console.log("click, "+b+", "+c),analyzeActorsAtPositionAndRunReactions(b,c)}function analyzeActorsAtPositionAndRunReactions(a,b){if("undefined"!=typeof window.animation.currentScene){console.log("analyzing click for "+a+" / "+b);for(var c,d=window.animation.currentScene.actors,e=[],f=!1,g=0;g<d.length;g++)c=d[g],"undefined"!=typeof d[g].imagesizeY&&d[g].pointIsAboveActor(a,b)&&e.push(d[g]);console.log("\nvisible actors at click, from top to bottom:");for(var h,i=e.length-1;i>=0;i--)c=e[i],h=e[i].filename,c.currentlyVisible||(h+=" (invisible)"),"undefined"!=typeof c.passesTouchThroughSet&&c.passesTouchThroughSet&&(h+=" – passes touch through"),"undefined"!=typeof c.evaluateFirstWhenClicked&&c.evaluateFirstWhenClicked&&(h+=" – PRIORITY: "+c.overrideZIndexExtraValue),c.reactions.length>0&&(h+=" – "+pluralize(c.reactions.length,"no reactions","one reaction","%count% reactions")),c.currentlyVisible&&console.log("- "+h);var j=_.filter(e,function(a){return"undefined"!=typeof a.evaluateFirstWhenClicked&&a.evaluateFirstWhenClicked});j=_.sortBy(j,"overrideZIndexExtraValue");for(var k=j.length-1;k>=0;k--)if(c=j[k],!c.passesTouchThroughSet&&c.currentlyVisible){c.reactions.length>0&&(console.log("executing priority-actor: "+c.filename),c.react()),f=!0;break}var l=_.filter(e,function(a){return"undefined"==typeof a.evaluateFirstWhenClicked||!a.evaluateFirstWhenClicked});if(!f)for(var m=l.length-1;m>=0;m--)if(c=l[m],(void 0===typeof c.evaluateFirstWhenClicked||!c.evaluateFirstWhenClicked)&&!c.passesTouchThroughSet&&c.currentlyVisible){c.reactions.length>0&&(console.log("executing non-priority-actor: "+c.filename),c.react());break}}}function arrayMinus(a,b){for(var c=a,d=c.length-1;d>=0;d--)for(var e=b.length-1;e>=0;e--)if(b[e].match(c[d])){c=arrayWithout(c,d);break}return c}function arrayWithout(a,b){var c=b>0?a.slice(0,b):[],d=a.slice(b+1);return c.concat(d)}function compatibleBrowser(){return!0}function getOrCreateIdentity(){var a;getParameterFromUrlByName("setuser").length>0?(localStorage.clear(),a=getParameterFromUrlByName("setuser")):a=localStorage.getItem("currentUserUuid"),null===a?(console.log("NO USER SAVED ON THIS MACHINE/BROWSER"),a=uuid(),console.log("created identity "+a),localStorage.setItem("currentUserUuid",a)):console.log("existing identity "+a),currentUser={uuid:a},getOrCreateCurrentUserFromServer(a)}function identitylink(){return location.href.split(/[?|#]/)[0]+"?setuser="+currentUser.uuid}function make_script_tag(a){var b=document.createElement("script");b.src=a,b.type="text/javascript",document.body.appendChild(b)}function server_url(){return"http://animation.io"}function getOrCreateCurrentUserFromServer(a){var b=server_url()+"/getorcreate/"+encodeURIComponent(a);b+="?cachebuster="+(new Date).getTime().toString(),make_script_tag(b)}function setCurrentUser(a){console.log("data"),_.each(JSON.parse(a),function(a,b){keyIsSynced(b)||null===localStorage.getItem(b)?localStorage.setItem(b,a):updateKey(b,localStorage.getItem(b))}),console.log(a),window.currentUser=JSON.parse(a),window.currentUserLoaded=!0}function keyOr(a,b){return null===localStorage.getItem(a)?b:"true"===localStorage.getItem(a)?!0:"false"===localStorage.getItem(a)?!1:localStorage.getItem(a)}function updateKey(a,b){if(localStorage.setItem(a,b),"undefined"==typeof AnimationIO.offlineHack&&!AnimationIO.offlineHack){setKeyAsUnsynced(a);var c=server_url()+"/setvalue";c+="/"+encodeURIComponent(currentUser.uuid),c+="/"+encodeURIComponent(a),c+="/"+encodeURIComponent(b),make_script_tag(c)}}function setKeyAsSynced(a){localStorage.setItem(a+"_synced","true")}function setKeyAsUnsynced(a){localStorage.removeItem(a+"_synced")}function keyIsSynced(a){return null!==localStorage.getItem(a+"_synced")}function keyUpdated(a){localStorage.setItem(a+"_lastsave",now())}function keyAge(a){return parseInt(localStorage.getItem(a+"_lastsave"),10)?now()-parseInt(localStorage.getItem(a+"_lastsave"),10):0}function updateScrolling(a,b){(0!==a.scrollPositionVectorX||b)&&(a.scrollPositionX+a.scrollPositionVectorX<=0?(a.scrollPositionX=0,a.hideLeftScrolling(),a.showRightScrolling()):a.scrollPositionX+a.scrollPositionVectorX>=a.dimensions.x-a.animation.dimensions.x?(a.hideRightScrolling(),a.showLeftScrolling(),a.scrollPositionX=a.dimensions.x-a.animation.dimensions.x):(a.scrollPositionX+=a.scrollPositionVectorX,a.showLeftScrolling(),a.showRightScrolling())),(b||Math.abs(-a.scrollPositionX)||Math.abs(-a.scrollPositionY))&&a.setPerspective(-a.scrollPositionX,-a.scrollPositionY),a.scrollPositionVectorX=a.scrollPositionVectorY=0}function ScrollingTo(a,b,c,d,e,f){var g,h,i,j=new Plugin(0,.5,a,e,f),k=-(a.scene.scrollPositionX-b),l=-(a.scene.scrollPositionY-c),m=now(),n=0,o=0;return j.reset=function(){g=void 0,k>0?g="right":0>k&&(g="down"),h=void 0,l>0?h="down":0>l&&(h="up")},j.reset(),j.applybehavior=function(){!i&&g&&(n=easeOut(now()-m,0,k,d),Math.abs(n)>=Math.abs(k)&&(i=!0,n=-(a.scene.scrollPositionX-b),o=0),a.scene.scrollPositionVectorX+=n-o,o=n)},j}function ScrollingBy(a,b,c,d,e){var f=new Plugin(0,.5);b=-b,c=-c,f.triggeredByAction=e;var g,h,i,j=!1,k=now(),l=0,m=0;return f.reset=function(){b>0?g="right":0>b&&(g="down"),c>0?h="down":0>c&&(h="up")},f.reset(),f.applybehavior=function(){i||j||!g||(l=easeOut(now()-k,0,b,d),i=Math.abs(l)>=Math.abs(b),i||(a.scene.scrollPositionVectorX+=l-m,m=l))},f}function ScrollingOnHover(a,b,c,d){var e=new Plugin(0,.5);return e.active=!1,e.currentSpeed=b,e.applybehavior=function(){this.active&&(this.currentSpeed*=c,Math.abs(this.currentSpeed)>Math.abs(d)&&(this.currentSpeed=sameprefix(b,d)),a.scene.scrollPositionVectorX=this.currentSpeed)},a.scene.scrollingActors.push(a),e}function config(a){a.config={maximumAnimationAge:minutesToMilliseconds(120),waitForServer:1e4,waitingText:"loading data from server",maximumLoadWait:minutesToMilliseconds(1.5),maximumLoadWaitExceededMessage1:"Die maximale Ladezeit von 90 Sekunden wurde erreicht. Die Szene wird jetzt angezeigt. Folgende Objekte haben keine Lade-Rückmeldung gegeben:\n",maximumLoadWaitExceededMessage2:"\n\nMöchten Sie eine E-Mail an Mehreinfach senden mit wichtigen Infos zu diesen Ladeproblemen?",cdnDomain:!1}}function EvaluatingOnCreate(actor,evalCode,triggeredByAction,reactionTargetIndex){var executing=new Plugin(0,0,actor,triggeredByAction,reactionTargetIndex);return eval(evalCode),executing}function Waving(a,b,c,d,e,f,g){var h=new Plugin(0,0,a,f,g);return h.reset=function(){this.actor=a,this.hertz=c,this.radius=b},h.applybehavior=function(){"undefined"==typeof this.wavingStartedAt&&(this.wavingStartedAt=now()),this.skew=Math.sin((this.wavingStartedAt-now())*this.hertz/1e3)*this.radius,this.actor.image.style.webkitTransformOrigin=d+"px "+e+"px",this.actor.image.style.webkitTransform="skew("+this.skew+"deg, 0deg)",this.actor.image.style.transformOrigin=d+"px "+e+"px",this.actor.image.style.transform="skew("+this.skew+"deg, 0deg)",this.actor.image.style.msTransformOrigin=d+"px "+e+"px",this.actor.image.style.msTransform="skew("+this.skew+"deg, 0deg)",this.actor.image.style.OTransformOrigin=d+"px "+e+"px",this.actor.image.style.OTransform="skew("+this.skew+"deg, 0deg)"},h}function Appearing(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f),h=!1;return g.haveTurnedItVisible=!1,g.opacityStep=0,g.appearLength=c,g.startsVisible="undefined"!=typeof d&&d===!0?!0:!1,g.cleanup=function(){this.cleanupPlugin(),this.startsVisible&&this.targetObject.setVisible()},g.reset=function(){this.resetPlugin(),h=!1,this.startsVisible||this.targetObject.visibleForever?this.targetObject.setVisible():this.targetObject.setInvisible(),this.opacityStep=60/this.appearLength,this.done=!1,this.resetStartAnimationTimestamp(),this.haveTurnedItVisible=!1,this.newOpacity=0},g.reset(),g.applybehavior=function(){return h?(!this.done&&this.age()>b&&(this.haveTurnedItVisible||(this.forever?this.targetObject.setVisibleForever(this.newOpacity):this.targetObject.setVisible(this.newOpacity),this.haveTurnedItVisible=!0),this.newOpacity=this.newOpacity.addUntilTarget(this.opacityStep,1),this.targetObject.alterOpacity(this.newOpacity),this.isDoneWhen(this.targetObject.currentOpacity>=1)),void 0):(console.log("started "+this.actor.filename),this.resetStartAnimationTimestamp(),h=!0,void 0)},g}function Moving(a,b,c,d,e,f,g){var h=new Plugin(f,g);return h.actor=a,h.force={x:b,y:c},h.speed={x:0,y:0},h.friction=d,h.gravitation=e,h.triggeredByTouch=!1,h.reset=function(){this.resetPlugin(),h.speed={x:0,y:0},h.force={x:b,y:c}},h.reset(),h.applybehavior=function(){1!==this.factor()&&(console.log("this.factor(): "+this.factor()),console.log("this.age(): "+this.age())),h.force.x=.9*h.force.x,h.force.y=.9*h.force.y,"undefined"!=typeof h.gravitation&&(h.force.y+=h.gravitation/50),h.speed.x+=h.force.x,h.speed.y+=h.force.y,"undefined"!=typeof h.friction&&(h.speed.x=h.speed.x*(1-h.friction/50),h.speed.y=h.speed.y*(1-h.friction/50)),h.actor.vector.x+=h.speed.x*this.factor(),h.actor.vector.y+=h.speed.y*this.factor()},h}function MovingTo(a,b,c,d,e,f,g){var h=new Plugin(0,.5,a,f,g);return h.targetObject.targetX=b,h.targetObject.targetY=c,h.triggeredByAction=f,h.actor=a,h.targetObject=isNumeric(g)?a.reactionTargets[g]:a,h.reset=function(){this.force={x:d,y:e},this.finishedMovingTo=!1},h.reset(),h.applybehavior=function(){if(!this.finishedMovingTo){var a=vector(this.targetObject.position.x,this.targetObject.position.y,h.targetObject.targetX,h.targetObject.targetY);a.distance>2?(this.targetObject.vector.x+=this.force.x*a.x,this.targetObject.vector.y+=this.force.y*a.y):(a.distance=10,this.finishedMovingTo=!0)}},h}function Swinging(a,b,c,d,e,f,g,h){var i=new Plugin(0,0,a,g,h);return i.degrees=0,i.runningValue=0,i.radius=b,i.hertz=c,i.swingcenterX=d,i.swingcenterY=e,i.degreeOffset=f,i.reset=function(){this.oldDegrees=0,this.newDegrees=0,this.firstRun=!0},i.applybehavior=function(){this.runningValue=Math.sin(this.targetObject.age()*this.hertz/1e3),this.degrees=this.runningValue*this.radius/2,this.firstRun?(this.firstRun=!1,this.oldDegrees=this.degrees,this.spin=this.degreeOffset):(this.targetObject.image.style.transformOrigin=this.swingcenterX+"px "+this.swingcenterY+"px",this.targetObject.image.style.webkitTransformOrigin=this.swingcenterX+"px "+this.swingcenterY+"px",this.targetObject.image.style.msTransformOrigin=this.swingcenterX+"px "+this.swingcenterY+"px",this.targetObject.spin=this.oldDegrees-this.degrees),this.oldDegrees=this.degrees},i}function Pulsating(a,b,c,d,e,f){console.log("adding pulsaing to "+a.filename),a.rotationCenterX=a.imagesizeX/2,a.rotationCenterY=a.imagesizeY/2;var g=new Plugin(0,0,a,e,f),h=1,i=1,j="up",k=0,l=!1;return g.reset=function(){this.resetPlugin(),("undefined"==typeof d||notNumeric(d))&&(d=0),h=1,i=1,j="up",k=0,l=!1},g.reset(),g.applybehavior=function(){(0===d||d>=k)&&(i=h,h=1+c/10*Math.sin((new Date-this.startAnimationTimestamp)*b*2/500),h>i&&"down"===j?j="up":i>h&&"up"===j&&(j="down",l=!1),g.targetObject.image.style.webkitTransform="scale("+h+", "+h+")",g.targetObject.image.style.transform="scale("+h+", "+h+")",!l&&"up"===j&&h>1&&(k++,l=!0))},g}function Dissolving(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);f.originalOpacity=AnimationIO.helper.floatValueOfOr(a.currentOpacity,1),f.originalVisibility=a.image.style.visibility,f.startAfter=b,f.newOpacity=0,f.opacityStep=60/c;var g=!1;return f.reset=function(){this.resetPlugin(),g=!1,this.newOpacity=this.originalOpacity,this.targetObject.setVisible()},f.reset(),f.cleanup=function(){this.targetObject.image.style.visibility=this.originalVisibility,this.targetObject.alterOpacity(this.originalOpacity)},f.applybehavior=function(){g||(this.resetStartAnimationTimestamp(),g=!0),!this.done&&this.age()>this.startAfter&&(this.newOpacity=this.newOpacity.subtractUntilZero(this.opacityStep),this.targetObject.alterOpacity(this.newOpacity),this.isDoneWhen(this.newOpacity<=0&&this.targetObject.currentOpacity<=0),this.done&&(this.forever?this.targetObject.setInvisibleForever():this.targetObject.setInvisible()))},f}function Rotating(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);f.plugintype="rotating",f.spin=6*b;var g=1e3*c*b;return f.applybehavior=function(){this.done||(this.targetObject.spin+=this.spin,this.running||(this.running=!0),this.done=this.done||!(0!==c||this.age()>g),this.done&&(console.log("rotations !== 0: "+(0!==c)),console.log("this.age(): "+this.age()),console.log("targetAge: "+g),console.log("rotations: "+c)))},f}function Playing(a,b,c,d,e,f,g,h,i){"/"!==AnimationIO.config.audioPath.slice(-1)&&(AnimationIO.config.audioPath+="/");var j=new Plugin(0,0,a,h,i);"undefined"!=typeof c&&(j.actor.playingImagePath="images/"+c),j.actor.waitingImagePath=j.actor.image.src,j.actor.playEndFunction=g,j.actor.pulsatesWhilePlaying=!1,j.actor.playLooped=d,j.actor.playOnLoad=e,j.actor.playOnLoadExecuted=!1,j.actor.audio=document.createElement("audio"),j.actor.audio.setAttribute("preload","auto");var k=document.createElement("source");return j.reset=function(){j.actor.playOnLoadExecuted=!1,j.actor.audioplaying=!1,j.actor.audio.pause(),j.actor.audioplaying=!1},j.reset(),j.applybehavior=function(){this.actor.playOnLoad&&!this.actor.playOnLoadExecuted&&(this.actor.playOnLoadExecuted=!0,this.actor.toggleAudio())},j.actor.showPlayingImage=function(){"undefined"!=typeof this.playingImagePath&&(this.image.src=this.playingImagePath),this.pulsatesWhilePlaying&&(console.log("pulsates"),this.pulsates(3,.1,0,0,!0))},j.actor.showWaitingImage=function(){this.image.src=this.waitingImagePath,this.pulsatesWhilePlaying&&(this.behaviors=[])},j.actor.audio.canPlayType("audio/mpeg;")?(k.type="audio/mpeg",k.src=AnimationIO.config.audioPath+b+".mp3"):(k.type="audio/ogg",k.src=AnimationIO.config.audioPath+b+".ogg"),j.actor.audio.source=k,j.actor.audio.appendChild(k),j.actor.audio.actor=j.actor,j.actor.audio.betweenLoops=f||0,j.actor.playLooped?bindEvent(j.actor.audio,"ended",function(){j.actor.showWaitingImage(this.actor),j.actor.nextBackgroundLoop&&(j.actor.audio.canPlayType("audio/mpeg;")?j.actor.audio.source.setAttribute("src",AnimationIO.config.audioPath+j.actor.nextBackgroundLoop+".mp3"):j.actor.audio.source.setAttribute("src",AnimationIO.config.audioPath+j.actor.nextBackgroundLoop+".ogg"),j.actor.audio.load(),j.actor.nextBackgroundLoop=null),setTimeout(function(){j.actor.toggleAudio("play")},j.actor.audio.betweenLoops)}):bindEvent(j.actor.audio,"ended",function(){j.actor.showWaitingImage(this.actor),j.actor.audioplaying=!1,"undefined"!=typeof j.actor.playEndFunction&&j.actor.playEndFunction()}),j.actor.toggleAudio=function(a){"play"===a?this.playAudio():"pause"===a?this.pauseAudio():this.audioplaying?this.pauseAudio():this.playAudio()},j.actor.playAudio=function(){this.audio.currentTime&&(this.audio.currentTime=0),this.backgroundPlayer||this.scene.muteNonBackground(),this.audio.play(),this.showPlayingImage(),this.audioplaying=!0},j.actor.pauseAudio=function(a){this.audio.pause(),this.audioplaying=!1,this.showWaitingImage(),"undefined"==typeof a&&(a=!0),a&&"undefined"!=typeof this.playEndFunction&&(console.log("*** pausing Audio!"),this.playEndFunction())},j.actor.reacts("this.toggleAudio();"),j}function StopPlaying(a,b,c){var d=new Plugin(0,0,a,b,c);return d.targetObject.pauseAudio(),d}function StartsPlaying(a,b,c){var d=new Plugin(0,0,a,b,c);return d.targetObject.playAudio(),d}function Drifting(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);return f.reset=function(){this.resetPlugin(),this.force={x:b,y:c}},f.reset(),f.applybehavior=function(){this.targetObject.vector.x+=this.force.x,this.targetObject.vector.y+=this.force.y},f}function Shaking(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f);return g.plugintype="shaking",g.reset=function(){this.peak={x:b/2,y:c/2},this.hertz=d,this.actor=a,this.force={x:0,y:0},this.shakingStartedAt=null},g.applybehavior=function(){null===typeof this.shakingStartedAt&&(this.shakingStartedAt=now()),this.tmpValue=Math.sin((this.shakingStartedAt-now())*this.hertz/250),"undefined"!=typeof this.lastTmpValue&&(this.targetObject.vector.x+=(this.lastTmpValue-this.tmpValue)*this.peak.x,this.targetObject.vector.y+=(this.lastTmpValue-this.tmpValue)*this.peak.y),this.lastTmpValue=this.tmpValue},g}function Linking(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);return f.actor=a,f.url=b,/iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?bindEvent(f.targetObject.image,"touchstart",function(){this.gotourl()}):bindEvent(f.targetObject.image,"mousedown",function(){this.gotourl()}),f.actor.image.gotourl=function(){window.open(b,c);return!1},f.applybehavior=function(){},f}function togglesText(a){this.reset=function(){},this.reset(),this.applybehavior=function(){a.vector.x+=this.force.x,a.vector.y+=this.force.y}}function MovementCloning(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f);return g.applybehavior=function(){this.targetObject.position.x=b.position.x+c,this.targetObject.position.y=b.position.y+d,this.targetObject.image.style.left=this.targetObject.position.x+"px",this.targetObject.image.style.top=this.targetObject.position.y+"px",this.targetObject.tilt=b.tilt},g}function CountResetter(a,b,c){var d=new Plugin(0,0,a,b,c);return d.reset=function(){this.resetPlugin(),this.targetObject.counter=this.targetObject.syncs()?parseInt(keyOr(this.synckey+"-counter",AnimationIO.helper.integerValueOfOr(this.targetObject.counterInitialAmount||0)),10):AnimationIO.helper.integerValueOfOr(this.targetObject.counterInitialAmount||0),this.targetObject.autosetCountertext()},d.reset(),d}function HavingText(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f);return g.targetObject.originalText=String(b),g.targetObject.textDiv=document.createElement("div"),g.targetObject.textDiv.setAttribute("id",c),g.targetObject.textDiv.setAttribute("class","hastext "+d),g.targetObject.textDivInner=document.createElement("div"),g.targetObject.textDivInner.setAttribute("class","inner"),g.targetObject.textDiv.appendChild(g.targetObject.textDivInner),g.targetObject.textDiv.style.zIndex="2",g.targetObject.textDiv.style.width=g.targetObject.imagesize.x+"px",g.targetObject.textDiv.style.height=g.targetObject.imagesize.y+"px",g.targetObject.textDiv.style.pointerEvents="none",g.targetObject.scene.div.appendChild(g.targetObject.textDiv),g.targetObject.textDivInner.innerHTML=b,g.applybehavior=function(){g.targetObject.textDiv.style.zIndex=g.targetObject.actualZIndex()+5,g.targetObject.textDiv.style.visibility=g.targetObject.image.style.visibility,g.targetObject.textDiv.style.left=g.targetObject.position.x+"px",g.targetObject.textDiv.style.top=g.targetObject.position.y+"px",g.targetObject.textDiv.style.opacity=g.targetObject.currentOpacity,g.targetObject.textDiv.style.transform="rotate("+g.targetObject.tilt+"deg)",g.targetObject.textDiv.style.webkitTransform="rotate("+g.targetObject.tilt+"deg)",g.targetObject.textDiv.style.msTransform="rotate("+g.targetObject.tilt+"deg)",g.targetObject.textDiv.style.transformOrigin=g.targetObject.image.style.transformOrigin,g.targetObject.textDiv.style.webkitTransformOrigin=g.targetObject.image.style.webkitTransformOrigin,g.targetObject.textDiv.style.msTransformOrigin=g.targetObject.image.style.msTransformOrigin
},g}function Multichoicing(a,b,c){var d=new Plugin(0,0,a,b,c);return d.reset=function(){this.resetPlugin()},d.reset(),d.applybehavior=function(){},d}function AppearingAsQuestion(a,b,c){var d=new Plugin(0,0,a,b,c);d.targetObject.setVisible();for(var e=d.targetObject.rightanswers.length-1;e>=0;e--)d.targetObject.rightanswers[e].setVisible();for(var f=d.targetObject.wronganswers.length-1;f>=0;f--)d.targetObject.wronganswers[f].setVisible();return d}function ChangingImageSrc(a,b,c,d){var e=new Plugin(0,0,a,c,d);return e.applybehavior=function(){this.targetObject.changeImageSrc(b)},e}function Circling(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f);return g.tilt=d,g.reset=function(){g.resetPlugin(),g.newX=0,g.newY=0,g.vectorX=0,g.vectorY=0,g.oldX=0,g.oldY=0,g.firstRun=!0},g.counter=0,g.applybehavior=function(){this.counter=this.counter+1,"undefined"==typeof this.circlingStartedAt&&(this.circlingStartedAt=now()),this.tmpValue=this.circlingStartedAt-now(),this.newX=b*Math.cos(this.tmpValue/500*c)*2,this.newY=b*Math.sin(this.tmpValue/500*c)*2,this.vectorX=this.newX-this.oldX,this.vectorY=this.newY-this.oldY,this.oldX=this.newX,this.oldY=this.newY,this.firstRun?this.firstRun=!1:(this.targetObject.vector.x+=this.vectorX,this.targetObject.vector.y+=this.vectorY)},g}function Popup(a,b,c,d,e,f,g,h,i){var j=new Plugin(0,0,a,h,i);return"undefined"==typeof window.closepopup&&(window.closepopup=function(a){var b=document.getElementById(a);b.scene.div.removeChild(b),b.actor.popup=!1}),j.cleanup=function(){j.cleanupPlugin(),j.targetObject.popup&&j.destroy()},j.create=function(){j.iframeDivId=randomId(),j.wrapdiv=window.document.createElement("DIV"),j.wrapdiv.setAttribute("id",j.iframeDivId),j.wrapdiv.setAttribute("class","popupdiv"),j.wrapdiv.style.width=c+"px",j.wrapdiv.style.height=d+"px",j.wrapdiv.style.left=j.targetObject.absolutePositionTopLeftX()+e+"px",j.wrapdiv.style.top=j.targetObject.absolutePositionTopLeftY()+f+"px",j.wrapdiv.scene=j.targetObject.scene,j.wrapdiv.actor=j.targetObject;var a=window.document.createElement("a");a.setAttribute("class","closer");var h=document.createTextNode("×");a.href="javascript:void(0)",a.setAttribute("onclick","closepopup('"+j.iframeDivId+"');"),a.appendChild(h),j.wrapdiv.appendChild(a),j.iframe=window.document.createElement("IFRAME"),j.iframe.setAttribute("src",b),j.iframe.setAttribute("class","iframe"),j.iframe.style.width=c+"px",j.iframe.style.height=d+"px",j.targetObject.popup=j,j.wrapdiv.appendChild(j.iframe),j.targetObject.scene.div.appendChild(j.wrapdiv),g>0&&(j.targetObject.popup.closetimeout=setTimeout("window.closepopup('"+j.iframeDivId+"')",g))},j.destroy=function(){j.targetObject.scene.div.removeChild(document.getElementById(j.targetObject.popup.iframeDivId)),j.targetObject.popup=!1},j.targetObject.popup?j.destroy():j.create(),j}function Bouncing(a,b,c,d,e,f,g){var h=new Plugin(0,0,a,f,g);return h.reset=function(){this.resetPlugin(),this.amplitude=b,this.speed=c,this.times=d,this.damping=e,this.startedAt=now(),this.lastX=0,this.lastY=0},h.reset(),h.applybehavior=function(){var a=(now()-this.startedAt)*this.speed/1e3,b=this.times<1||a<this.times?-(this.amplitude*Math.abs(Math.sin(a*this.speed*Math.PI))*Math.pow(this.damping,a)):0;this.targetObject.vector.y+=b-this.lastY,this.lastY=b,this.isDoneWhen(0===b),this.done&&console.log("******** DONE")},h}function PlayVideo(a,b,c,d,e,f){var g=new Plugin(0,0,a,e,f),h=3;return g.newPlayTime=c,g.playLength=d,g.videoReadyToPlay=!1,g.cleanup=function(){this.cleanupPlugin(),this.targetObject.image.pause(),this.targetObject.image.currentTime="undefined"==typeof c?0:g.newPlayTime/1e3},g.reset=function(){g.videoReadyToPlay=!1,this.resetPlugin()},g.reset(),g.applybehavior=function(){return a.image.readyState<h?(this.isDoneWhen(!1),void 0):(g.videoReadyToPlay||("undefined"!=typeof c&&(this.targetObject.image.currentTime=g.newPlayTime/1e3),g.videoReadyToPlay=!0),"undefined"!=typeof g.playLength&&this.targetObject.image.currentTime>(g.newPlayTime+g.playLength)/1e3&&this.targetObject.image.pause(),this.done||("undefined"==typeof b?(this.targetObject.image.play(),this.isDoneWhen(!0)):this.targetObject.age()>b&&(this.targetObject.image.play(),this.isDoneWhen(!0))),void 0)},g}function PauseVideo(a,b,c,d){var e=new Plugin(0,0,a,c,d),f=3;return e.cleanup=function(){this.cleanupPlugin()},e.reset=function(){this.resetPlugin()},e.reset(),e.applybehavior=function(){return a.image.readyState<f?(this.isDoneWhen(!1),void 0):(this.done||("undefined"==typeof b?(this.targetObject.image.pause(),this.isDoneWhen(!0)):this.targetObject.age()>b&&(this.targetObject.image.pause(),this.isDoneWhen(!0))),void 0)},e}function PlayVimeo(a,b,c){var d=new Plugin(0,0,a,b,c);return d.cleanup=function(){this.cleanupPlugin();var a={method:"pause"},b=this.targetObject.image.src.split("?")[0];this.targetObject.image.contentWindow.postMessage(JSON.stringify(a),b)},d.reset=function(){this.resetPlugin()},d.reset(),d.applybehavior=function(){if(!this.done){var a={method:"play"},b=this.targetObject.image.src.split("?")[0];this.targetObject.image.contentWindow.postMessage(JSON.stringify(a),b),this.isDoneWhen(!0)}},d}function PauseVimeo(a,b,c){var d=new Plugin(0,0,a,b,c);return d.cleanup=function(){this.cleanupPlugin()},d.reset=function(){this.resetPlugin()},d.reset(),d.applybehavior=function(){if(!this.done){var a={method:"pause"},b=this.targetObject.image.src.split("?")[0];this.targetObject.image.contentWindow.postMessage(JSON.stringify(a),b),a={method:"unload"},b=this.targetObject.image.src.split("?")[0],this.targetObject.image.contentWindow.postMessage(JSON.stringify(a),b),this.isDoneWhen(!0)}},d}function ScrollPopUp(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);return f.triggeredByAction=d,f.reset=function(){this.finishedVisibility=!1},f.reset(),f.applybehavior=function(){this.finishedVisibility||this.targetObject.image.contentWindow.scrollBy(c,b),this.finishedVisibility=!0},f}function ScrollText(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);return f.triggeredByAction=d,f.reset=function(){this.finishedScrolling=!1},f.reset(),f.applybehavior=function(){this.finishedScrolling||"undefined"!=typeof this.targetObject.textDiv&&(this.targetObject.textDiv.scrollTop+=c),this.finishedScrolling=!0},f}function HideObject(a,b,c,d,e){var f=new Plugin(0,0,a,d,e);return f.triggeredByAction=d,f.reset=function(){this.finished=!1},f.reset(),f.applybehavior=function(){this.finished||(b.style.visibility=c?"hidden":""),this.finished=!0},f}function Stopping(a,b,c,d){for(var e=new Plugin(0,0,a,c,d),f=e.targetObject.behaviors.length-1;f>=0;f--)e.targetObject.behaviors[f].plugintype===b&&e.targetObject.behaviors[f].running&&(e.targetObject.behaviors[f].done=!0,console.log("stopping rotating "+f));return e}function Cranking(a,b,c,d,e,f,g,h){var i=new Plugin(0,0,a,g,h);return i.degrees=0,i.runValue=0,i.radius=b,i.length=c,i.actor.rotationCenterX=d,i.actor.rotationCenterY=e,i.degreeOffset=f,i.currentDirection="clockwise","undefined"==typeof i.actor.currentCrankFunctionPointer&&(i.actor.currentCrankFunctionPointer=0),i.reset=function(){this.oldDegrees=0,this.newDegrees=0,this.firstRun=!0},i.applybehavior=function(){this.runValue=Math.sin(this.age()/this.length),this.degrees=this.runValue*this.radius,this.firstRun?(this.firstRun=!1,this.oldDegrees=this.degrees,this.spin+=this.degreeOffset):"clockwise"===this.actor.crankdirection?this.targetObject.spin+=this.oldDegrees-this.degrees:this.targetObject.spin-=this.oldDegrees-this.degrees,this.oldDegrees=this.degrees,this.age()>=c&&(this.done=!0,this.actor.crankEndfunctions[this.actor.currentCrankFunctionPointer](this.actor),this.actor.currentCrankFunctionPointer++,this.actor.currentCrankFunctionPointer>=this.actor.crankEndfunctions.length&&(this.actor.currentCrankFunctionPointer=0),this.actor.crankEndfunctions.length>0&&this.actor.resetReactions())},i}var AnimationIO={};if(requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Animation.prototype.startLoop=function(){var a=this;a.animloop=function(){requestAnimFrame(a.animloop);try{for(var b=0;b<a.currentScene.actors.length;b++)animateactor(a.currentScene.actors[b]),updateScrolling(a.currentScene)}catch(c){}},a.animloop()},AnimationIO.loadFirstScene=function(a){window.animation.waitingForServersyncDiv&&window.animation.stageDiv.removeChild(window.animation.waitingForServersyncDiv),window.animation.loadAndShow(a),window.animation.startLoop(),fadeIn(window.animation.innerWrapper)},AnimationIO.coreAnimationLoader=function(a,b,c,d,e){if(setTimeout(function(){window.scrollTo(0,1)},100),window.animation=new Animation({width:d,height:e,firstSceneName:c}),window.animation.innerWrapper=a,window.animation.outerWrapperDiv=b,window.animation.innerWrapper.appendChild(window.animation.stageDiv),AnimationIO.offlineHack&&(window.animation.config.waitForServer=0),window.animation.config.waitForServer>0){var f=document.createElement("img");f.src="images/waiting.gif",window.animation.waitingForServersyncDiv=document.createElement("div"),window.animation.waitingForServersyncDiv.id="waitingdiv",window.animation.waitingForServersyncDiv.appendChild(f),window.animation.stageDiv.appendChild(window.animation.waitingForServersyncDiv)}dowhen(function(){AnimationIO.loadFirstScene(c)},"window.currentUserLoaded",500,window.animation.config.waitForServer)},Animation.prototype.showLoader=function(){var a=300,b=300;this.loader=document.createElement("div"),this.loader.setAttribute("class","animationloader"),this.loader.style.width=window.animation.dimensions.x+"px",this.loader.style.height=window.animation.dimensions.y+"px",this.loader.inner=document.createElement("div"),this.loader.inner.setAttribute("class","inner"),this.loader.loadText=document.createElement("div"),this.loader.loadText.setAttribute("class","percentage"),this.loader.loadimage=document.createElement("img"),this.loader.loadimage.setAttribute("src","http://animation.io/engine/loader.gif"),this.loader.loadimage.setAttribute("class","loadimage"),this.loader.inner.style.width=a+"px",this.loader.inner.style.height=b+"px",this.loader.inner.style.left=(window.animation.dimensions.x-a)/2+"px",this.loader.inner.style.top=(window.animation.dimensions.y-b)/2+"px",this.loader.appendChild(this.loader.inner),this.loader.inner.appendChild(this.loader.loadimage),this.loader.inner.appendChild(this.loader.loadText),this.stageDiv.appendChild(this.loader)},Animation.prototype.updateLoader=function(a){a=Math.ceil(a),a=a>=100?100:a,a=10>a?"0"+a:a,this.loader.loadText.innerHTML=a+"%"},Animation.prototype.hideLoader=function(){try{window.animation.stageDiv.removeChild(this.loader)}catch(a){}},AnimationIO.config={},AnimationIO.config.imagePath="images",AnimationIO.config.audioPath="audio","undefined"==typeof AnimationIO.custom&&(AnimationIO.custom={}),AnimationIO.dom||(AnimationIO.dom={}),AnimationIO.dom.createDiv=function(a,b){var c=document.createElement("div");return c.setAttribute("id",a),c.setAttribute("class",b),c},AnimationIO.helper={},AnimationIO.helper.truth=function(a){return"undefined"==typeof a||"undefined"===a||"false"===a||null==a?!1:Boolean(a)},AnimationIO.helper.floatValueOfOr=function(a,b){return isNumeric(a)?parseFloat(a):b},AnimationIO.helper.integerValueOfOr=function(a,b){return isNumeric(a)?parseInt(a,10):b},AnimationIO.helper.domainFromURL=function(a){var b=a.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return b&&b[1]},AnimationIO.helper.generateUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},AnimationIO.helper.isEven=function(a){return isNumeric(a)&&a%2===0},AnimationIO.helper.isOdd=function(a){return isNumeric(a)&&a%2===1},AnimationIO.helper.toStringWithType=function(a){return typeof a+": "+a},AnimationIO.helper.fromStringWithType=function(a){if("undefined"==typeof a||null===a||void 0===a)return void 0;var b=a.substr(0,a.indexOf(": "));if(""===b)return void 0;var c=a.substr(a.indexOf(": ")+2,a.length);return"number"===b?parseFloat(c):"boolean"===b?"true"===c:c},AnimationIO.sinus={},AnimationIO.sinus.createTable=function(a){var b=[],c=0,d=2*Math.PI/a;do b.push(Math.sin(c)),c+=d;while(c<2*Math.PI);return b},AnimationIO.sinus.table=AnimationIO.sinus.createTable(1e3),AnimationIO.sinus.get=function(a){return AnimationIO.helper.sinusTable[parseInt(a%1e3,10)]},AnimationIO.sinus.fromTime=function(){return AnimationIO.sinus.table[parseInt(new Date.getTime%1e3,10)]},AnimationIO.sinus.fromTimeForTesting=function(a){return AnimationIO.sinus.table[parseInt(a%1e3,10)]},Animation.prototype.reloadAndFadeToScene=function(a){var b=parseInt(/scene(\d+)/.exec(a)[1],10);window.location.hash=b;var c=1200;fadeOut(window.animation.innerWrapper,c/2),setTimeout(function(){window.location.href=this.currentScene.url(),window.location.reload()},c/2+250)},Animation.prototype.showScene=function(a){var b=this;window.animation.age()>=b.config.maximumAnimationAge?b.reloadAndFadeToScene(a):(!b.currentScene||b.currentScene.age()>1e3)&&(b.currentScene&&b.currentScene.cleanup(),b.currentScene=b.loadScene(a),b.currentScene.enterActors(),b.currentScene.reset(),b.currentScene.makeOthersInvisible(),b.currentScene.muteOthers(),updateScrolling(b.currentScene,!0),b.dropUnneededScenes(b.currentScene.preloadSceneIds),b.loadNeededScenes(b.currentScene.preloadSceneIds),window.forceReloadTimer=setTimeout('window.animation.reloadAndFadeToScene("'+a+'")',window.animation.config.maximumAnimationAge),b.currentScene.syncs&&updateKey("scene",a))},Animation.prototype.showFirstScene=function(){this.showScene(this.firstSceneName)},Animation.prototype.loadAndShow=function(a){window.animation.loadingInterval&&(console.log("stopping loading process to start another"),this.hideLoader(),clearInterval(window.animation.loadingInterval)),this.showLoader(),this.startedLoadingAt=now();var b=window.animation.loadSceneFresh(a);console.log("started loading scene "+a),window.animation.loadingInterval=setInterval(function(){if(this.loadingtime=Math.abs(this.startedLoadingAt-now()),b.hasLoaded()||this.loadingtime>this.config.maximumLoadWait){if(this.loadingtime>this.config.maximumLoadWait){for(var c=this.config.maximumLoadWaitExceededMessage1,d=b.namesOfLoadingActors(),e=d.length-1;e>=0;e--)c+="\n· "+d[e];if(c+=this.config.maximumLoadWaitExceededMessage2,console.log(d),confirm(c)){for(var f="The following objects failed to load on time:\n",g=d.length-1;g>=0;g--)f+="\n· "+d[g];f+="\n\nSzene: "+b.id;try{f+="\n\n"+navigator.userAgent}catch(h){f+="Couldn't determine userAgent."}window.location.href="mailto:speedlab@mehreinfach.de?subject=Animation.io%20Preload&"+encodeURIComponent(location.href)+"&body="+encodeURIComponent(f),console.log("should send mail")}}clearInterval(window.animation.loadingInterval),console.log("Loading of "+a+" complete."),window.animation.showScene(a),window.animation.hideLoader()}else console.log("Waiting for scene "+a+" to load. loadingTime: "+this.loadingtime),window.animation.updateLoader(b.loadedPercentage())},1e3)},Animation.prototype.loadSceneFresh=function(a){for(var b=this.loadedScenes.length-1;b>=0;b--)if(this.loadedScenes[b].id===a)return this.loadedScenes[b];for(var c=this.loadedScenes.length-1;c>=0;c--)if(this.loadedScenes[c].id===a)return this.dropScene(this.loadedScenes[c].id);return this.buildScene(a)},Animation.prototype.buildScene=function(sceneid){var newScene=eval("window."+sceneid+"()");return _.each(newScene.actors,function(a){a.initiallyVisible=a.currentlyVisible}),newScene.setDivSizeToStage(),this.loadedScenes.push(newScene),newScene.stageDiv=this.stageDiv,this.stageDiv.appendChild(newScene.div),newScene.makeInvisible(),newScene},Animation.prototype.loadedSceneIds=function(){for(var a=[],b=this.loadedScenes.length-1;b>=0;b--)a.push(this.loadedScenes[b].id);return a},Animation.prototype.dropUnneededScenes=function(a){for(var b=arrayMinus(this.loadedSceneIds(),a),c=b.length-1;c>=0;c--)this.dropScene(b[c])},Animation.prototype.loadNeededScenes=function(a){for(var b=arrayMinus(a,this.loadedSceneIds()),c=b.length-1;c>=0;c--)this.loadScene(b[c])},Animation.prototype.loadScene=function(a){for(var b=this.loadedScenes.length-1;b>=0;b--)if(this.loadedScenes[b].id===a)return this.loadedScenes[b];return this.buildScene(a)},Animation.prototype.dropScene=function(a){for(var b=this.loadedScenes.length-1;b>=0;b--)if(this.loadedScenes[b].id===a){{document.getElementById(a)}this.stageDiv.removeChild(this.loadedScenes[b].div),this.loadedScenes=arrayWithout(this.loadedScenes,b)}},Animation.prototype.age=function(){return now()-this.startAnimationTimestamp},Animation.prototype.startAnimationTimestamp=now(),Animation.prototype.makeOlder=function(a){return this.startAnimationTimestamp-=a,this},Animation.prototype.resetAnimationTimestamp=function(){return this.startAnimationTimestamp=now(),this},!window.console)var console={log:function(){},warn:function(){},error:function(){},time:function(){},timeEnd:function(){}};Number.prototype.subtractUntilZero=function(a){return a>=this?0:this-a},Number.prototype.addUntilTarget=function(a,b){var c=this+a;return c>b?b:c},function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return arguments.length<2||c?a[x.random(a.length-1)]:x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={},f=null==c?x.identity:B(c);return y(b,function(c,g){var h=f.call(d,c,g,b);a(e,h,c)}),e}};x.groupBy=C(function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"iPad",identity:"iPad"}]};
BrowserDetect.init(),function(a){function b(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function c(a,b){var c=d(a,b)?f:e;c(a,b)}var d,e,f;"classList"in document.documentElement?(d=function(a,b){return a.classList.contains(b)},e=function(a,b){a.classList.add(b)},f=function(a,b){a.classList.remove(b)}):(d=function(a,c){return b(c).test(a.className)},e=function(a,b){d(a,b)||(a.className=a.className+" "+b)},f=function(a,c){a.className=a.className.replace(b(c)," ")});var g={hasClass:d,addClass:e,removeClass:f,toggleClass:c,has:d,add:e,remove:f,toggle:c};"function"==typeof define&&define.amd?define("classie/classie",g):a.classie=g}(window),function(){function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype;d.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}.call(this),function(a){var b=document.documentElement,c=function(){};b.addEventListener?c=function(a,b,c){a.addEventListener(b,c,!1)}:b.attachEvent&&(c=function(b,c,d){b[c+d]=d.handleEvent?function(){var b=a.event;b.target=b.target||b.srcElement,d.handleEvent.call(d,b)}:function(){var c=a.event;c.target=c.target||c.srcElement,d.call(b,c)},b.attachEvent("on"+c,b[c+d])});var d=function(){};b.removeEventListener?d=function(a,b,c){a.removeEventListener(b,c,!1)}:b.detachEvent&&(d=function(a,b,c){a.detachEvent("on"+b,a[b+c]);try{delete a[b+c]}catch(d){a[b+c]=void 0}});var e={bind:c,unbind:d};"function"==typeof define&&define.amd?define("eventie/eventie",e):a.eventie=e}(this),function(a){function b(a){if(a){if("string"==typeof d[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(var b,e=0,f=c.length;f>e;e++)if(b=c[e]+a,"string"==typeof d[b])return b}}var c="Webkit Moz ms Ms O".split(" "),d=document.documentElement.style;"function"==typeof define&&define.amd?define("get-style-property/get-style-property",[],function(){return b}):a.getStyleProperty=b}(window),function(a){function b(a){var b=parseFloat(a),c=-1===a.indexOf("%")&&!isNaN(b);return c&&b}function c(){for(var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},b=0,c=h.length;c>b;b++){var d=h[b];a[d]=0}return a}function d(a){function d(a){if("string"==typeof a&&(a=document.querySelector(a)),a&&"object"==typeof a&&a.nodeType){var d=g(a);if("none"===d.display)return c();var f={};f.width=a.offsetWidth,f.height=a.offsetHeight;for(var k=f.isBorderBox=!(!j||!d[j]||"border-box"!==d[j]),l=0,m=h.length;m>l;l++){var n=h[l],o=d[n];o=e(a,o);var p=parseFloat(o);f[n]=isNaN(p)?0:p}var q=f.paddingLeft+f.paddingRight,r=f.paddingTop+f.paddingBottom,s=f.marginLeft+f.marginRight,t=f.marginTop+f.marginBottom,u=f.borderLeftWidth+f.borderRightWidth,v=f.borderTopWidth+f.borderBottomWidth,w=k&&i,x=b(d.width);x!==!1&&(f.width=x+(w?0:q+u));var y=b(d.height);return y!==!1&&(f.height=y+(w?0:r+v)),f.innerWidth=f.width-(q+u),f.innerHeight=f.height-(r+v),f.outerWidth=f.width+s,f.outerHeight=f.height+t,f}}function e(a,b){if(f||-1===b.indexOf("%"))return b;var c=a.style,d=c.left,e=a.runtimeStyle,g=e&&e.left;return g&&(e.left=a.currentStyle.left),c.left=b,b=c.pixelLeft,c.left=d,g&&(e.left=g),b}var i,j=a("boxSizing");return function(){if(j){var a=document.createElement("div");a.style.width="200px",a.style.padding="1px 2px 3px 4px",a.style.borderStyle="solid",a.style.borderWidth="1px 2px 3px 4px",a.style[j]="border-box";var c=document.body||document.documentElement;c.appendChild(a);var d=g(a);i=200===b(d.width),c.removeChild(a)}}(),d}var e=document.defaultView,f=e&&e.getComputedStyle,g=f?function(a){return e.getComputedStyle(a,null)}:function(a){return a.currentStyle},h=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("get-size/get-size",["get-style-property/get-style-property"],d):a.getSize=d(a.getStyleProperty)}(window),function(a){function b(a,b){for(var c in b)a[c]=b[c];return a}function c(){}function d(d,e,g,j,k){function m(a,c){this.element="string"==typeof a?f.querySelector(a):a,this.options=b({},this.options),b(this.options,c),this._create()}function n(){return!1}function o(a,b){a.x=void 0!==b.pageX?b.pageX:b.clientX,a.y=void 0!==b.pageY?b.pageY:b.clientY}function p(a,b,c){return c=c||"round",b?Math[c](a/b)*b:a}var q=j("transform"),r=!!j("perspective");b(m.prototype,e.prototype),m.prototype.options={},m.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=b({},this.position),this.enable(),this.setHandles()},m.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];for(var a=0,b=this.handles.length;b>a;a++){var c=this.handles[a];g.bind(c,"mousedown",this),g.bind(c,"touchstart",this),t(c)}};var s="attachEvent"in f.documentElement,t=s?function(a){"IMG"===a.nodeName&&(a.ondragstart=n);for(var b=a.querySelectorAll("img"),c=0,d=b.length;d>c;c++){var e=b[c];e.ondragstart=n}}:c;m.prototype._getPosition=function(){var a=h(this.element),b=parseInt(a.left,10),c=parseInt(a.top,10);this.position.x=isNaN(b)?0:b,this.position.y=isNaN(c)?0:c,this._addTransformPosition(a)},m.prototype._addTransformPosition=function(a){if(q){var b=a[q];if(0===b.indexOf("matrix")){var c=b.split(","),d=0===b.indexOf("matrix3d")?12:4,e=parseInt(c[d],10),f=parseInt(c[d+1],10);this.position.x+=e,this.position.y+=f}}},m.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},m.prototype.getTouch=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];if(d.identifier===this.pointerIdentifier)return d}},m.prototype.onmousedown=function(a){var b=a.button;b&&0!==b&&1!==b||this.dragStart(a,a)},m.prototype.ontouchstart=function(a){this.isDragging||this.dragStart(a,a.changedTouches[0])},m.prototype.dragStart=function(b,c){if(this.isEnabled){b.preventDefault?b.preventDefault():b.returnValue=!1;var e="touchstart"===b.type;this.pointerIdentifier=c.identifier,this._getPosition(),this.measureContainment(),o(this.startPoint,c),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this._bindEvents({events:e?["touchmove","touchend","touchcancel"]:["mousemove","mouseup"],node:b.preventDefault?a:f}),d.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("dragStart",[this,b,c]),this.animate()}},m.prototype._bindEvents=function(a){for(var b=0,c=a.events.length;c>b;b++){var d=a.events[b];g.bind(a.node,d,this)}this._boundEvents=a},m.prototype._unbindEvents=function(){var a=this._boundEvents;if(a&&a.events){for(var b=0,c=a.events.length;c>b;b++){var d=a.events[b];g.unbind(a.node,d,this)}delete this._boundEvents}},m.prototype.measureContainment=function(){var a=this.options.containment;if(a){this.size=k(this.element);var b=this.element.getBoundingClientRect(),c=i(a)?a:"string"==typeof a?f.querySelector(a):this.element.parentNode;this.containerSize=k(c);var d=c.getBoundingClientRect();this.relativeStartPosition={x:b.left-d.left,y:b.top-d.top}}},m.prototype.onmousemove=function(a){this.dragMove(a,a)},m.prototype.ontouchmove=function(a){var b=this.getTouch(a.changedTouches);b&&this.dragMove(a,b)},m.prototype.dragMove=function(a,b){o(this.dragPoint,b);var c=this.dragPoint.x-this.startPoint.x,d=this.dragPoint.y-this.startPoint.y,e=this.options.grid,f=e&&e[0],g=e&&e[1];if(c=p(c,f),d=p(d,g),this.options.containment){var h=this.relativeStartPosition.x,i=this.relativeStartPosition.y,j=p(-h,f,"ceil"),k=p(-i,g,"ceil"),l=this.containerSize.width-h-this.size.width,m=this.containerSize.height-i-this.size.height;l=p(l,f,"floor"),m=p(m,g,"floor"),c=Math.min(l,Math.max(j,c)),d=Math.min(m,Math.max(k,d))}this.position.x=this.startPosition.x+c,this.position.y=this.startPosition.y+d,this.dragPoint.x=c,this.dragPoint.y=d,this.emitEvent("dragMove",[this,a,b])},m.prototype.onmouseup=function(a){this.dragEnd(a,a)},m.prototype.ontouchend=function(a){var b=this.getTouch(a.changedTouches);b&&this.dragEnd(a,b)},m.prototype.dragEnd=function(a,b){this.isDragging=!1,delete this.pointerIdentifier,q&&(this.element.style[q]="",this.setLeftTop()),this._unbindEvents(),d.remove(this.element,"is-dragging"),this.emitEvent("dragEnd",[this,a,b])},m.prototype.ontouchcancel=function(a){var b=this.getTouch(a.changedTouches);this.dragEnd(a,b)},m.prototype.animate=function(){if(this.isDragging){this.positionDrag();var a=this;l(function(){a.animate()})}};var u=r?function(a,b){return"translate3d( "+a+"px, "+b+"px, 0)"}:function(a,b){return"translate( "+a+"px, "+b+"px)"};return m.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},m.prototype.positionDrag=q?function(){this.element.style[q]=u(this.dragPoint.x,this.dragPoint.y)}:m.prototype.setLeftTop,m.prototype.enable=function(){this.isEnabled=!0},m.prototype.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},m}for(var e,f=a.document,g=f.defaultView,h=g&&g.getComputedStyle?function(a){return g.getComputedStyle(a,null)}:function(a){return a.currentStyle},i="object"==typeof HTMLElement?function(a){return a instanceof HTMLElement}:function(a){return a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},j=0,k="webkit moz ms o".split(" "),l=a.requestAnimationFrame,m=a.cancelAnimationFrame,n=0;n<k.length&&(!l||!m);n++)e=k[n],l=l||a[e+"RequestAnimationFrame"],m=m||a[e+"CancelAnimationFrame"]||a[e+"CancelRequestAnimationFrame"];l&&m||(l=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-j)),e=a.setTimeout(function(){b(c+d)},d);return j=c+d,e},m=function(b){a.clearTimeout(b)}),"function"==typeof define&&define.amd?define(["classie/classie","eventEmitter/EventEmitter","eventie/eventie","get-style-property/get-style-property","get-size/get-size"],d):a.Draggabilly=d(a.classie,a.EventEmitter,a.eventie,a.getStyleProperty,a.getSize)}(window),Actor.prototype.isOnTop=function(a){return this.evaluateFirstWhenClicked=this.overrideZIndex=!0,this.overrideZIndexExtraValue=AnimationIO.helper.integerValueOfOr(a,0),this},Actor.prototype.actualZIndex=function(){return this.overrideZIndex?10*(this.scene.actors.length+1)+this.overrideZIndexExtraValue:this.zIndex},Actor.prototype.comeBack=function(a){this.comesBack=!0,"undefined"==typeof a&&(a=0),this.resetDelay=a},Actor.prototype.resetToOriginalPositionOnOut=Actor.prototype.comeBack,Actor.prototype.delays=function(a){this.originaldelay=a,this.delay=a},Actor.prototype.age=function(){return now()-this.startAnimationTimestamp},Actor.prototype.extraResetFunctions=[],Actor.prototype.reset=function(){this.resetBehaviors(),this.resetReactions(),this.resetStartAnimationTimestamp(),this.resetVisibility(),this.position={x:this.startX,y:this.startY},this.vector={x:0,y:0},this.lastVector={x:0,y:0},this.setSize(this.imagesizeX,this.imagesizeY),this.delay=this.originaldelay,this.finishedDelaying=!1,this.startedDelayingAt=null,this.tilt=0,moveActor(this),tiltActor(this);for(var a=this.extraResetFunctions.length-1;a>=0;a--)this.extraResetFunctions[a](this);"undefined"!=typeof this.flippinghorizontally&&this.flippinghorizontally&&(this.image&&this.image.filters&&this.image.filters.item?this.image.style.filter="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":(this.image.style.transform+=" scaleX(-1)",this.image.style.webkitTransform+=" scaleX(-1)"))},Actor.prototype.resetStartAnimationTimestamp=function(){this.startAnimationTimestamp=now()},Actor.prototype.resetReactions=function(){for(var a=this.reactions.length-1;a>=0;a--)this.reactions[a].reset()},Actor.prototype.resetBehaviors=function(){for(var a=this.behaviors.length-1;a>=0;a--)this.behaviors[a].reset()},Actor.prototype.absolutePositionTopLeftX=Actor.prototype.absolutePositionBottomLeftX=function(){return this.position.x+this.offsetX-this.zeroOffsX},Actor.prototype.absolutePositionTopLeftY=Actor.prototype.absolutePositionTopRightY=function(){return this.position.y+this.offsetY-this.zeroOffsY},Actor.prototype.absolutePositionTopRightX=Actor.prototype.absolutePositionBottomRightX=function(){return"undefined"==typeof this.imagesizeX?!1:this.position.x+this.offsetX-this.zeroOffsX+this.imagesizeX},Actor.prototype.absolutePositionBottomLeftY=Actor.prototype.absolutePositionBottomRightY=function(){return"undefined"==typeof this.imagesizeY?!1:this.position.y+this.offsetY-this.zeroOffsY+this.imagesizeY},Actor.prototype.absoluteCoordinates=function(){return{origin:{x:this.absolutePositionTopLeftX()+this.rotationCenterX,y:this.absolutePositionTopLeftY()+this.rotationCenterY},topLeft:{x:this.absolutePositionTopLeftX(),y:this.absolutePositionTopLeftY()},topRight:{x:this.absolutePositionTopRightX(),y:this.absolutePositionTopRightY()},bottomRight:{x:this.absolutePositionBottomRightX(),y:this.absolutePositionBottomRightY()},bottomLeft:{x:this.absolutePositionBottomLeftX(),y:this.absolutePositionBottomLeftY()}}},Actor.prototype.logAbsoluteCoordinates=function(){var a="absolute coordinates of "+this.filename+":\n";a+="tl: "+Math.round(this.absoluteCoordinates().topLeft.x,2)+", "+Math.round(this.absoluteCoordinates().topLeft.y,2),a+=" ––––– tr: "+Math.round(this.absoluteCoordinates().topRight.x,2)+", "+Math.round(this.absoluteCoordinates().topRight.y,2),a+="\n  |                   |",a+="\n  |                   |",a+="\nbl: "+Math.round(this.absoluteCoordinates().bottomLeft.x,2)+", "+Math.round(this.absoluteCoordinates().bottomLeft.y,2),a+=" ––––– br: "+Math.round(this.absoluteCoordinates().bottomRight.x,2)+", "+Math.round(this.absoluteCoordinates().bottomRight.y,2),console.log(a)},Actor.prototype.absoluteTiltedPositionTopLeftX=function(){return rotateXaroundOriginByAngle(this.absolutePositionTopLeftX(),this.absolutePositionTopLeftY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionTopLeftY=function(){return rotateYaroundOriginByAngle(this.absolutePositionTopLeftX(),this.absolutePositionTopLeftY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionTopRightX=function(){return"undefined"==typeof this.imagesizeX?(console.warn("Could not calculate top right x-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateXaroundOriginByAngle(this.absolutePositionTopRightX(),this.absolutePositionTopRightY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionTopRightY=function(){return"undefined"==typeof this.imagesizeY?(console.warn("Could not calculate top right x-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateYaroundOriginByAngle(this.absolutePositionTopRightX(),this.absolutePositionTopRightY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionBottomRightX=function(){return"undefined"==typeof this.imagesizeX?(console.warn("Could not calculate bottom right x-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateXaroundOriginByAngle(this.absolutePositionBottomRightX(),this.absolutePositionBottomRightY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionBottomRightY=function(){return"undefined"==typeof this.imagesizeY?(console.warn("Could not calculate bottom right y-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateYaroundOriginByAngle(this.absolutePositionBottomRightX(),this.absolutePositionBottomRightY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionBottomLeftX=function(){return"undefined"==typeof this.imagesizeX?(console.warn("Could not calculate bottom left x-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateXaroundOriginByAngle(this.absolutePositionBottomLeftX(),this.absolutePositionBottomLeftY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.absoluteTiltedPositionBottomLeftY=function(){return"undefined"==typeof this.imagesizeY?(console.warn("Could not calculate bottom left y-coordinate of "+this.filename+" in "+this.scene.id+" because imagesize not set."),!1):rotateYaroundOriginByAngle(this.absolutePositionBottomLeftX(),this.absolutePositionBottomLeftY(),this.rotationCenterX+this.absolutePositionTopLeftX(),this.rotationCenterY+this.absolutePositionTopLeftY(),this.tilt*Math.PI/180)},Actor.prototype.tiltedCoordinates=function(){return{origin:{x:this.absoluteTiltedPositionTopLeftX()+this.rotationCenterX,y:this.absoluteTiltedPositionTopLeftY()+this.rotationCenterY},topLeft:{x:this.absoluteTiltedPositionTopLeftX(),y:this.absoluteTiltedPositionTopLeftY()},topRight:{x:this.absoluteTiltedPositionTopRightX(),y:this.absoluteTiltedPositionTopRightY()},bottomRight:{x:this.absoluteTiltedPositionBottomRightX(),y:this.absoluteTiltedPositionBottomRightY()},bottomLeft:{x:this.absoluteTiltedPositionBottomLeftX(),y:this.absoluteTiltedPositionBottomLeftY()}}},Actor.prototype.tiltedCoordinatesText=function(){var a="";return a+=" topLeft: "+Math.round(this.tiltedCoordinates().topLeft.x,2)+", "+Math.round(this.tiltedCoordinates().topLeft.y,2),a+=" | topRight: "+Math.round(this.tiltedCoordinates().topRight.x,2)+", "+Math.round(this.tiltedCoordinates().topRight.y,2),a+=" | bottomLeft: "+Math.round(this.tiltedCoordinates().bottomLeft.x,2)+", "+Math.round(this.tiltedCoordinates().bottomLeft.y,2),a+=" | bottomRight: "+Math.round(this.tiltedCoordinates().bottomRight.x,2)+", "+Math.round(this.tiltedCoordinates().bottomRight.y,2)},Actor.prototype.pointIsAboveActor=function(a,b){var c=Math.min(this.tiltedCoordinates().topLeft.x,this.tiltedCoordinates().topRight.x,this.tiltedCoordinates().bottomLeft.x,this.tiltedCoordinates().bottomRight.x),d=Math.max(this.tiltedCoordinates().topLeft.x,this.tiltedCoordinates().topRight.x,this.tiltedCoordinates().bottomLeft.x,this.tiltedCoordinates().bottomRight.x),e=a>=c&&d>=a,f=Math.min(this.tiltedCoordinates().topLeft.y,this.tiltedCoordinates().topRight.y,this.tiltedCoordinates().bottomLeft.y,this.tiltedCoordinates().bottomRight.y),g=Math.max(this.tiltedCoordinates().topLeft.y,this.tiltedCoordinates().topRight.y,this.tiltedCoordinates().bottomLeft.y,this.tiltedCoordinates().bottomRight.y),h=b>=f&&g>=b;return e&&h},Actor.prototype.showCorners=function(){this.showsCorners=!0,this.topLeft=redDot(this.scene,this.absoluteTiltedPositionTopLeftX(),this.absoluteTiltedPositionTopLeftY(),this.layer),this.topRight=redDot(this.scene,this.absoluteTiltedPositionTopRightX(),this.absoluteTiltedPositionTopRightY(),this.layer),this.bottomLeft=redDot(this.scene,this.absoluteTiltedPositionBottomLeftX(),this.absoluteTiltedPositionBottomLeftY(),this.layer),this.bottomRight=redDot(this.scene,this.absoluteTiltedPositionBottomRightX(),this.absoluteTiltedPositionBottomRightY(),this.layer)},Actor.prototype.updateCorners=function(){this.topLeft.position={x:this.absoluteTiltedPositionTopLeftX()+this.scene.scrollPositionX,y:this.absoluteTiltedPositionTopLeftY()+this.scene.scrollPositionY},this.topRight.position={x:this.absoluteTiltedPositionTopRightX()+this.scene.scrollPositionX,y:this.absoluteTiltedPositionTopRightY()+this.scene.scrollPositionY},this.bottomLeft.position={x:this.absoluteTiltedPositionBottomLeftX()+this.scene.scrollPositionX,y:this.absoluteTiltedPositionBottomLeftY()+this.scene.scrollPositionY},this.bottomRight.position={x:this.absoluteTiltedPositionBottomRightX()+this.scene.scrollPositionX,y:this.absoluteTiltedPositionBottomRightY()+this.scene.scrollPositionY}},Actor.prototype.setPhaseCycleLength=function(a){return this.phaseCycle=a,this},Actor.prototype.currentPhase=function(){var a=0,b=this.phases.length;if(1>=b)return a;var c=now()-(this.cyclesOnce?this.startedCyclingOnceAt:this.enteredAt),d=this.phaseCycle/b,e=c%(b*d);return a=parseInt(e/d,10)},Actor.prototype.setVisible=function(a){var b=this;return"undefined"!=typeof a&&(b.alterOpacity(a),updateKey(b.synckey+"-invisibleForever",!1),updateKey(b.synckey+"-visibleForever",!0)),b.image.style.visibility="visible",b.textDiv&&(b.textDiv.style.visibility="visible"),"undefined"!=typeof b.textDiv&&(b.textDiv.style.overflow="auto"),b.currentlyVisible=!0,b},Actor.prototype.setInitiallyVisible=function(){var a=this;a.setVisible(),a.initiallyVisible=!0},Actor.prototype.setVisibleForever=function(a){var b=this;if(!b.syncs())throw"Set synckey for actor "+b.filename+" to set it visible forever.";return b.setVisible(a),b.setValue("visible",!0),b},Actor.prototype.isVisibleForever=function(){if(!this.syncs())return!1;var a=this.getValue("visible");return a===!0},Actor.prototype.setInvisible=function(){var a=this;return a.currentlyVisible=!1,a.image.style.visibility="hidden",a.textDiv&&(a.textDiv.style.visibility="hidden"),"undefined"!=typeof a.textDiv&&(a.textDiv.style.overflow="hidden"),a},Actor.prototype.setInitiallyInvisible=function(){var a=this;a.setInvisible(),a.initiallyVisible=!1},Actor.prototype.setInvisibleForever=function(){var a=this;if(!a.syncs())throw"Set synckey for actor "+a.filename+" to set it visible forever.";return a.setInvisible(),a.setValue("visible",!1),a},Actor.prototype.isInvisibleForever=function(){if(!this.syncs())return!1;var a=this.getValue("visible");return a===!1},Actor.prototype.setInitialOpacity=function(a){return this.originalOpacity=a,this.alterOpacity(a),this},Actor.prototype.alterOpacity=function(a){return 0>=a&&(this.setInvisible(),a=0),!this.currentlyVisible&&a>0&&this.setVisible(),a>=1&&(a=1),a!==this.currentOpacity&&(this.currentOpacity=a,this.image.style.opacity=this.currentOpacity,this.image.style.filter="alpha(opacity="+100*this.currentOpacity+")",this.textDiv&&(this.textDiv.style.opacity=this.currentOpacity,this.textDiv.style.filter="alpha(opacity="+100*this.currentOpacity+")")),this},Actor.prototype.alterOpacityForever=function(a){var b=this;if(!b.syncs())throw'actor.alterOpacityForever() requires actor "'+b.filename+'" to have a synckey.';if("undefined"==typeof a)throw"actor.alterOpacityForever() requires opacity parameter.";return b.alterOpacity(a),b.setValue("opacity",b.currentOpacity),b},Actor.prototype.hasOpacityForever=function(){return this.syncs()&&"undefined"!=typeof this.getValue("opacity")},Actor.prototype.resetVisibility=function(){var a=this;a.setInitialOpacity(a.hasOpacityForever()?a.getValue("opacity"):a.originalOpacity),a.isVisibleForever()?a.setVisible():a.isInvisibleForever()?a.setInvisible():a.initiallyVisible===!0?a.setVisible():a.initiallyVisible===!1&&a.setInvisible(),console.log(a.filename+" "+a.isVisibleForever())},Actor.prototype.getValue=function(a){var b=this;if(!b.syncs())throw"actor.getValue() requires actor.synckey to be set.";var c=localStorage.getItem(b.getSynckey(a));return AnimationIO.helper.fromStringWithType(c)},Actor.prototype.setValue=function(a,b){var c=this;if(!c.syncs())throw"actor.setValue() requires actor.synckey to be set.";return b=AnimationIO.helper.toStringWithType(b),localStorage.setItem(c.getSynckey(a),b)},Actor.prototype.getValueOrDefault=function(a,b){var c=this;if(!c.syncs())throw"actor.getValueOrDefault() requires actor.synckey to be set.";if(!localStorage.hasOwnProperty(c.getSynckey(a)))return b;var d=localStorage.getItem(c.getSynckey(a));return AnimationIO.helper.fromStringWithType(d)};var Reaction=function(a,b,c){if(this.actor=paramOrVariable(a,"actor",a),"undefined"==typeof this.actor)throw"Plugin needs actor to be properly created.";return this.reactioncode=paramOrVariable(a,"reactioncode",b),this.reactHowOften=c,this.runs=this.actor.syncs()?keyOr(this.actor.synckey+"_resetcounter",0):0,(notNumeric(this.reactHowOften)||this.reactHowOften<0)&&(this.reactHowOften=0),this.reset=function(){this.runs=this.actor.syncs()?keyOr(this.actor.synckey+"_resetcounter",0):0},this};Actor.prototype.react=function(){for(var i=0;i<this.reactions.length;i++){var myReaction=this.reactions[i];(0===myReaction.reactHowOften||myReaction.runs<myReaction.reactHowOften)&&(eval(myReaction.reactioncode.replace("reactionTargetIndex",i)),myReaction.runs++,this.syncs()&&updateKey(this.synckey+"_resetcounter",myReaction.runs))}},Actor.prototype.reacts=function(a,b,c){if(this.addClass("reacts"),notNumeric(this.imagesize.x))return console.error("Actor "+this.filename+" in "+this.scene.id+" has no width set and can therefore not react."),void 0;if(notNumeric(this.imagesize.y))return console.error("Actor "+this.filename+" in "+this.scene.id+" has no height set and can therefore not react."),void 0;c="undefined"==typeof c?this:c;var d=new Reaction(this,a,b,c);this.reactions.push(d),this.reactionTargets.push(c)},Scene.prototype.extraResetFunctions=[],Scene.prototype.reset=function(){console.log('resetting scene "'+this.id+'"'),this.resetActors(),this.resetAge();for(var a=this.extraResetFunctions.length-1;a>=0;a--)this.extraResetFunctions[a](this);return this},Scene.prototype.resetActors=function(){for(var a=this.actors.length-1;a>=0;a--)this.actors[a].reset();return this},Scene.prototype.resetAge=function(){return this.displayedAt=Date.now(),this},Actor.prototype.navigatesOnTouch=function(a){this.reacts("window.animation.showScene('"+a+"')",0),this.addClass("navigation"),this.scene.preloadSceneIds.push(a)},Actor.prototype.navigatesAndLoadsOnTouch=function(a){this.reacts("window.animation.loadAndShow('"+a+"')",0),this.image.className+="navigation"},Actor.prototype.dontWaitForMeWhenLoading=!1,Actor.prototype.ignoreInLoader=function(){this.dontWaitForMeWhenLoading=!0},Actor.prototype.hasLoaded=function(){return!1},Scene.prototype.namesOfLoadingActors=function(){for(var a=[],b=this.actors.length-1;b>=0;b--)this.actors[b].dontWaitForMeWhenLoading||this.actors[b].hasLoaded()||a.push(this.actors[b].filename+" ("+this.actors[b].actortype+")");return a},Scene.prototype.numberOfLoadedActors=function(){for(var a=0,b=this.actors.length-1;b>=0;b--)this.actors[b].dontWaitForMeWhenLoading||this.actors[b].hasLoaded()?a++:console.log("Waiting for actor "+this.actors[b].filename+" to load.");return a},Scene.prototype.loadedPercentage=function(){return 0===this.actors.length?100:Math.round(this.numberOfLoadedActors()/this.actors.length*100)},Scene.prototype.hasLoaded=function(){return 100===this.loadedPercentage()},Scene.prototype.createActor=function(a,b,c,d,e){d&&!e&&console.error("Missing height-value for "+a+" in "+this.id+", please set both. (Browsers deal with the missing height value differently.)");var f=new Actor(b,c,d,e);return f.scene=this,f.actortype="image","undefined"!=typeof this.animation.config.cdnDomain&&this.animation.config.cdnDomain&&("/"!==this.animation.config.cdnDomain.slice(-1)&&(this.animation.config.cdnDomain+="/"),AnimationIO.config.imagePath=this.animation.config.cdnDomain+"/images",console.warn("The usage of config.cdnDomain is deprecated, please use AnimationIO.config.imagePath instead. More info at: See http://academy.mehreinfach.de/hc/de/articles/201131227")),"/"!==AnimationIO.config.imagePath.slice(-1)&&(AnimationIO.config.imagePath+="/"),f.setup=function(){f.image=document.createElement("img"),f.image.originalPath=a,f.filename=a.substring(a.lastIndexOf("/")+1),f.image.setAttribute("src",relativeOrAbsolutePath(AnimationIO.config.imagePath,f.image.originalPath)),f.image.setAttribute("class","actor"),this.image.setAttribute("draggable","false"),f.image.actor=f,f.phases.push(relativeOrAbsolutePath(AnimationIO.config.imagePath,a)),f.defaultdirectory=AnimationIO.config.imagePath,f.position={x:b,y:c},f.setSize(d,e),f.vector={x:0,y:0},bindEvent(f.image,"load",function(){f.hasLoaded=function(){return!0},this.removeEventListener("load",arguments.callee)}),moveActor(f)},f.setup(),f.scene=this,this.addActor(f),f},Actor.prototype.addPhase=function(a){var b=document.createElement("img");return b.setAttribute("src",relativeOrAbsolutePath(this.defaultdirectory,a)),b.setAttribute("draggable","false"),this.phases.push(relativeOrAbsolutePath(this.defaultdirectory,a)),this},Actor.prototype.cycleOnce=function(){this.cyclesOnce=!0,this.phaseCycling=!1},Scene.prototype.createVideoActor=function(a,b,c,d,e){var f=new Actor(b,c,d,e);f.actortype="video";var g="video/";return f.filename=a,f.setup=function(){f.image=document.createElement("video"),f.image.originalPath=a,f.filename=a.substring(a.lastIndexOf("/")+1),ismobile()&&f.image.setAttribute("controls","controls");var h=f.image.appendChild(document.createElement("source"));h.setAttribute("type","video/mp4"),h.setAttribute("src",relativeOrAbsolutePath(g,f.image.originalPath)+".mp4"),h=f.image.appendChild(document.createElement("source")),h.setAttribute("type","video/webm"),h.setAttribute("src",relativeOrAbsolutePath(g,f.image.originalPath)+".webm"),f.image.actor=f,f.defaultdirectory=g,f.position={x:b,y:c},f.setSize(d,e),f.vector={x:0,y:0},bindEvent(f.image,"mousedown",function(){f.react()}),bindEvent(f.image,"canplay",function(){f.hasLoaded=function(){return!0
},this.removeEventListener("canplay",arguments.callee)}),moveActor(f)},f.setup(),f.scene=this,this.addActor(f),f},Scene.prototype.createVimeoActor=function(a,b,c,d,e){var f=new Actor(b,c,d,e);return f.actortype="vimeo",f.filename="Vimeo video #"+a,f.setup=function(){f.image=document.createElement("iframe"),f.image.originalPath=a,f.image.setAttribute("src","http://player.vimeo.com/video/"+a+"?portrait=0&byline=0&portrait=0&api=1&title=0&player_id="+a+"&color=333"),f.image.setAttribute("width",d),f.image.setAttribute("height",e),f.image.setAttribute("frameborder","0"),f.image.setAttribute("webkitAllowFullScreen",""),f.image.setAttribute("mozallowfullscreen",""),f.image.setAttribute("allowFullScreen",""),f.image.actor=f,f.position={x:b,y:c},f.setSize(d,e),f.vector={x:0,y:0},bindEvent(f.image,"mousedown",function(){f.react()}),moveActor(f)},f.setup(),f.scene=this,this.addActor(f),f.hasLoaded=function(){return!0},f},Scene.prototype.createPopUpActor=function(a,b,c,d,e){var f=new Actor(b,c,d,e);return f.filename=f.URI=a,f.actortype="popup",f.setup=function(){f.image=document.createElement("IFRAME"),f.image.setAttribute("class","popupiframe"),f.image.setAttribute("src",f.URI),f.image.actor=f,f.position={x:b,y:c},f.setSize(d,e),f.vector={x:0,y:0},f.hasLoaded=function(){return!0},moveActor(f)},f.setup(),f.scene=this,this.addActor(f),f},Actor.prototype.addBehavior=function(a){try{a.reset()}catch(b){}return this.behaviors.push(a),this},Actor.prototype.cleanupBehaviors=function(){for(var a=this.behaviors.length-1;a>=0;a--)this.behaviors[a].cleanup()},Actor.prototype.removeBehaviorsThatCameFromReacts=function(){for(var a=[],b=this.behaviors.length-1;b>=0;b--)this.behaviors[b].triggeredByAction||a.push(this.behaviors[b]);this.behaviors.length!==a.length&&(this.behaviors=a)},bindEvent(window,"click",handleClick),Actor.prototype.isInLayer=function(a){this.layer=a,"undefined"==typeof this.scene.layers&&(this.scene.layers=[]),"undefined"==typeof this.scene.layers[a]&&(this.scene.layers[a]=[]),this.scene.layers[a].push(this);return this},Scene.prototype.scrollingPerspective=function(a,b){this.neutralLayer="undefined"==typeof a?10:a,this.horizonLayer="undefined"==typeof b?0:b,this.layerMultiplier=1/(this.neutralLayer-this.horizonLayer)},Scene.prototype.setPerspective=function(a,b){if(this.layers)for(var c=0;c<this.layers.length;c++)if("undefined"!=typeof this.layers[c])for(var d=1-(this.neutralLayer-c)*this.layerMultiplier,e=this.layers[c].length-1;e>=0;e--){var f=this.layers[c][e];a&&(0===f.zeroOffsX&&(f.zeroOffsX=c>=this.horizonLayer?a*d:-(a*d)),f.offsetX=a*d,f.needsMoving=!0),b&&(0===f.zeroOffsY&&(f.zeroOffsY=c>=this.horizonLayer?b*d:-(b*d*2)),f.offsetY=b*d,f.needsMoving=!0)}},Actor.prototype.shiftsPerspective=function(a,b){return this.scene.shiftPerspective(a,b),this},Actor.prototype.shiftsPerspectiveOnTouch=function(a,b){return this.reacts("this.shiftsPerspective("+a+", "+b+", true, reactionTargetIndex)",0),this},Scene.prototype.shiftPerspective=function(a,b){for(var c=0;c<this.layers.length;c++)if("undefined"!=typeof this.layers[c])for(var d=this.layers[c].length-1;d>=0;d--){var e=this.layers[c][d];a&&(e.offsetX+=a*(c-1),e.needsMoving=!0),b&&(e.offsetY+=b*(c-1),e.needsMoving=!0)}},Scene.prototype.scrollingActors=[],Scene.prototype.hideLeftScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)"undefined"!=typeof this.scrollingActors[b].direction&&"left"===this.scrollingActors[b].direction&&this.scrollingActors[b].currentlyVisible&&this.scrollingActors[b].dissolves(0,500);return this},Scene.prototype.hideRightScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)"undefined"!=typeof this.scrollingActors[b].direction&&"right"===this.scrollingActors[b].direction&&this.scrollingActors[b].currentlyVisible&&this.scrollingActors[b].dissolves(0,500);return this},Scene.prototype.showLeftScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)"undefined"!=typeof this.scrollingActors[b].direction&&"left"===this.scrollingActors[b].direction&&(this.scrollingActors[b].currentlyVisible||this.scrollingActors[b].appears(0,500));return this},Scene.prototype.showRightScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)"undefined"!=typeof this.scrollingActors[b].direction&&"right"===this.scrollingActors[b].direction&&(this.scrollingActors[b].currentlyVisible||this.scrollingActors[b].appears(0,500));return this},Scene.prototype.hideScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)this.scrollingActors[b].dissolves(0,a);return this},Actor.prototype.hideScrolling=function(a){return"undefined"==typeof a&&(a=1e3),this.scene.hideScrolling(a),this},Scene.prototype.showScrolling=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)this.scrollingActors[b].appears(0,a);return this},Actor.prototype.showScrolling=function(a){return"undefined"==typeof a&&(a=1e3),this.scene.showScrolling(a),this},Scene.prototype.hideScrollingForever=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)this.scrollingActors[b].dissolvesForever(0,a);return this},Actor.prototype.hideScrollingForever=function(a){return"undefined"==typeof a&&(a=1e3),this.scene.hideScrollingForever(a),this},Scene.prototype.showScrollingForever=function(a){"undefined"==typeof a&&(a=1e3);for(var b=this.scrollingActors.length-1;b>=0;b--)this.scrollingActors[b].appears(0,a);return this},Actor.prototype.showScrollingForever=function(a){return"undefined"==typeof a&&(a=1e3),this.scene.showScrollingForever(a),this},Actor.prototype.hidesScrollingOnTouch=function(a){return"undefined"==typeof a&&(a=1e3),this.reacts("this.scene.hideScrolling("+parseInt(a,10)+");",0,this),this},Actor.prototype.showsScrollingOnTouch=function(a){return"undefined"==typeof a&&(a=1e3),this.reacts("this.scene.showScrolling("+parseInt(a,10)+");",0,this),this},Actor.prototype.hidesScrollingForeverOnTouch=function(a){return"undefined"==typeof a&&(a=1e3),this.reacts("this.scene.hideScrollingForever("+parseInt(a,10)+");",0,this),this},Actor.prototype.showsScrollingForeverOnTouch=function(a){return"undefined"==typeof a&&(a=1e3),this.reacts("this.scene.showScrollingForever("+parseInt(a,10)+");",0,this),this},Actor.prototype.scrollsTo=function(a,b,c,d,e){d="undefined"==typeof d?!1:d;var f=new ScrollingTo(this,a,b,c,d,e);return this.addBehavior(f),this},Actor.prototype.scrollsToOnTouch=function(a,b,c){return this.reacts("this.scrollsTo("+a+","+b+","+c+", false, true, reactionTargetIndex);",0),this},Scene.prototype.getScrollAmountX=function(a,b){var c=1-(this.neutralLayer-b)*this.layerMultiplier;return a/c},Scene.prototype.getScrollAmountY=function(a,b){var c=1-(this.neutralLayer-b)*this.layerMultiplier;return a/c},Actor.prototype.scrollsToOnTouch3=function(a,b,c,d){return this.reacts("this.scrollsTo("+this.scene.getScrollAmountX(a,c)+","+this.scene.getScrollAmountY(b,c)+","+d+", true, reactionTargetIndex);",0),this},Actor.prototype.scrollsBy=function(a,b,c,d,e){d="undefined"==typeof d?!1:d;var f=new ScrollingBy(this,a,b,c,d,e);return this.addBehavior(f),this},Actor.prototype.scrollsByOnTouch=function(a,b,c){return this.scene.scrollingActors.push(this),this.reacts("this.scrollsBy("+-a+","+-b+","+c+", false, true, reactionTargetIndex);",0),this},Scene.prototype.getScrollAmountX=function(a,b){var c=1-(this.neutralLayer-b)*this.layerMultiplier;return a/c},Scene.prototype.getScrollAmountY=function(a,b){var c=1-(this.neutralLayer-b)*this.layerMultiplier;return a/c},Actor.prototype.scrollsHorizontalOnHover=function(a,b,c){if("iPad"!==BrowserDetect.OS){var d=new ScrollingOnHover(this,a,b,c,!1,0);this.addBehavior(d),bindEvent(this.image,"mouseover",function(){d.active=!0}),bindEvent(this.image,"mouseout",function(){d.active=!1,d.currentSpeed=a})}},Actor.prototype.setSynckey=function(a){var b=a.match(/[A-Za-z\-_0-9]/g).join("");if(b!==a&&console.warn('The synckey "'+a+'" uses characters that are not acceptable and was changed to "'+b+'".'),_.any(this.scene.actors,function(a){return a.syncs(b)}))throw'synckey "'+a+'" already in use in this scene.';return this.synckey=b,this},Actor.prototype.getSynckey=function(a){var b=this;if(!b.syncs())throw"Actor "+b.filename+" has no synckey that you could get.";var c=b.synckey;return"undefined"!=typeof a&&(c+="-"+a),"undefined"!=typeof AnimationIO.config.synckeyPrefix&&(c=AnimationIO.config.synckeyPrefix+"-"+c),c},Actor.prototype.syncs=function(a){return"undefined"==typeof this.synckey?!1:"undefined"==typeof a?!0:a===this.synckey},Actor.prototype.evaluatesOnCreate=function(a,b,c){var d=new EvaluatingOnCreate(this,a,b,c);return this.addBehavior(d),this},Actor.prototype.evaluatesOnTouch=function(a,b){return b="undefined"==typeof b?0:b,this.reacts("this.evaluatesOnCreate("+a+")",b),this},Actor.prototype.waves=function(a,b,c,d){return this.addBehavior(new Waving(this,a,b,c,d)),this},Actor.prototype.whenDroppedOn=function(a){var b=this;b.firstDroppedOn?b.firstDroppedOn=!1:(b.firstDroppedOn=!0,b.dropOptions=[]),b.dropOptions.push(a);var c=new Draggabilly(this.image,{containment:"#stage"});return c.actor=b,c.on("dragStart",function(a,b,c){a.startX=c.clientX,a.startY=c.clientY}),b.firstDroppedOn&&c.on("dragEnd",function(a,c,d){var e=d.clientX-a.startX,f=d.clientY-a.startY;b.position.x+=e,b.position.y+=f,_.each(b.dropOptions,function(a){"undefined"==typeof a.myCenterX&&(a.myCenterX=b.imagesizeX/2),"undefined"==typeof a.myCenterY&&(a.myCenterY=b.imagesizeY/2),"undefined"==typeof a.targetCenterX&&(a.targetCenterX=a.target.imagesizeX/2),"undefined"==typeof a.targetCenterY&&(a.targetCenterY=a.target.imagesizeY/2),console.log("self.position.x"),console.log(b.position.x),console.log("self.position.y"),console.log(b.position.y),console.log("optionset.myCenterX"),console.log(a.myCenterX),console.log("optionset.myCenterY"),console.log(a.myCenterY),console.log("optionset.target.position"),console.log(a.target.position);var c=distance(b.position.x+a.myCenterX,b.position.y+a.myCenterY,a.target.position.x+a.targetCenterX,a.target.position.y+a.targetCenterY);c<=a.precision?(console.log(b.filename+" dropped on "+a.target.filename),a.func()):console.log(b.filename+" not dropped on "+a.target.filename+", distance is "+c)})}),b},Actor.prototype.appears=function(a,b,c,d,e,f){var g=new Appearing(this,a,b,c,d,e);return d&&(g.triggeredByAction=d),f&&(g.forever=!0),this.addBehavior(g),this},Actor.prototype.appearsForever=function(a,b,c,d,e){this.appears(a,b,c,d,e,!0)},Actor.prototype.appearsOnTouch=function(a,b){return this.setInitialOpacity(0),this.reacts("this.appears("+AnimationIO.helper.integerValueOfOr(b,0)+","+a+", true, false, reactionTargetIndex);",0),this},Actor.prototype.appearsForeverOnTouch=function(a,b){return this.setInitialOpacity(0),this.reacts("this.appearsForever("+AnimationIO.helper.integerValueOfOr(b,0)+","+a+", true, false, reactionTargetIndex);",0),this},Actor.prototype.letsAppearStartsVisible=function(a,b,c){return this.reacts("this.appears("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", true, true, reactionTargetIndex);",0,a),this},Actor.prototype.letsAppearForeverStartsVisible=function(a,b,c){return this.reacts("this.appearsForever("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", true, true, reactionTargetIndex);",0,a),this},Actor.prototype.letsAppear=function(a,b,c){return this.extraResetFunctions.push(function(){a.setInvisible()}),this.reacts("this.appears("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", false, true, reactionTargetIndex);",0,a),this},Actor.prototype.letsAppearForever=function(a,b,c){return setInvisible(a),this.reacts("this.appearsForever("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", false, true, reactionTargetIndex);",1,a),this},Actor.prototype.letsAppearsForeverSynced=function(a,b){return"undefined"==typeof b&&(howoften=1),this.reacts("syncVisibleByKey('"+a+");",b),this},Actor.prototype.moves=function(a,b,c,d,e,f){return this.addBehavior(new Moving(this,a,b,c,d,e,f)),this},Actor.prototype.movesOnTouch=function(a,b,c,d,e,f){var g=a+","+b;return"undefined"!=typeof c&&(g+=", "+c),"undefined"!=typeof d&&(g+=", "+d),"undefined"!=typeof e&&(g+=", "+e),"undefined"!=typeof f&&(g+=", "+f),this.reacts("this.moves("+g+");"),this},Actor.prototype.movesTo=function(a,b,c,d,e,f){e="undefined"==typeof e?!1:e;var g=new MovingTo(this,a,b,c,d,e,f);return this.addBehavior(g),this},Actor.prototype.letsMoveTo=function(a,b,c,d,e){return this.reacts("this.movesTo("+b+","+c+","+d+","+e+", true, reactionTargetIndex);",0,a),this},Actor.prototype.movesToOnTouch=function(a,b,c,d){return this.reacts("this.movesTo("+a+","+b+","+c+","+d+", true, reactionTargetIndex);",1),this},Actor.prototype.swings=function(a,b,c,d,e,f,g){return this.addBehavior(new Swinging(this,a,b,c,d,e,f,g)),this},Actor.prototype.pulsates=function(a,b,c,d,e){console.log("Actor.prototype.pulsates");var f=new Pulsating(this,a,b,c,d,e);return this.addBehavior(f),this},Actor.prototype.pulsatesOnTouch=function(a,b,c,d){return this.reacts("this.pulsates("+a+", "+b+", "+c+", true, reactionTargetIndex);",d),this},Actor.prototype.letsPulsate=function(a,b,c,d,e){return this.reacts("this.pulsates("+b+", "+c+", "+d+", true, reactionTargetIndex);",e,a),this},Actor.prototype.dissolves=function(a,b,c,d,e){var f=new Dissolving(this,a,b,c,d);return"undefined"!=typeof c&&(f.triggeredByAction=c),e&&(f.forever=!0),this.addBehavior(f),this},Actor.prototype.dissolvesForever=function(a,b,c,d){return this.dissolves(a,b,c,d,!0),this},Actor.prototype.dissolvesOnTouch=function(a,b){return this.reacts("this.dissolves("+AnimationIO.helper.integerValueOfOr(b,0)+", "+AnimationIO.helper.floatValueOfOr(a,1e3)+", true, reactionTargetIndex);",0),this},Actor.prototype.dissolvesForeverOnTouch=function(a,b){return this.reacts("this.dissolvesForever("+AnimationIO.helper.integerValueOfOr(b,0)+", "+AnimationIO.helper.floatValueOfOr(a,1e3)+", true, reactionTargetIndex);",0),this},Actor.prototype.letsDissolveForever=function(a,b,c){return this.reacts("this.dissolvesForever("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", true, reactionTargetIndex);",0,a),this},Actor.prototype.letsDissolve=function(a,b,c){return this.reacts("this.dissolves("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", true, reactionTargetIndex);",0,a),this},Actor.prototype.letsForeverDissolve=function(a,b,c){return this.reacts("this.dissolvesForever("+AnimationIO.helper.integerValueOfOr(c,0)+", "+AnimationIO.helper.floatValueOfOr(b,1e3)+", true, reactionTargetIndex);",0,a),this},Actor.prototype.rotates=function(a,b,c,d){"undefined"==typeof b&&(b=0);var e=new Rotating(this,a,b,c,d);return this.addBehavior(e),this},Actor.prototype.rotatesOnTouch=function(a,b,c){return"undefined"==typeof b&&(b=0),this.reacts("this.rotates("+a+", "+b+", true, reactionTargetIndex);",c),this},Actor.prototype.togglesRotationOnTouch=function(a,b,c){return"undefined"==typeof b&&(b=0),this.reacts("this.rotates("+a+", "+b+", true, reactionTargetIndex);",c),this},Actor.prototype.letsRotate=function(a,b,c,d){return"undefined"==typeof c&&(c=0),this.reacts("this.rotates("+b+", "+c+", true, reactionTargetIndex);",d,a),this},Actor.prototype.plays=function(a,b){var c=this;return setTimeout(function(){c.addBehavior(new Playing(c,a,b,!1,!1))},500),this},Actor.prototype.playsOnLoad=function(a,b){var c=this;return setTimeout(function(){c.addBehavior(new Playing(c,a,b,!1,!0))},500),this},Actor.prototype.playsSolo=function(a,b){var c=this;this.soloPlayer=!0;var d=new Playing(c,a,b,!1,!1);return setTimeout(function(){c.addBehavior(d)},500),this},Actor.prototype.playsAndExecutesOnStop=function(a,b,c){var d=this,e=new Playing(d,a,b,!1,!1,!1,c);return setTimeout(function(){d.addBehavior(e)},500),this},Actor.prototype.playsLoop=function(a,b,c){var d=this,e=new Playing(d,a,b,!0,!1,c);return setTimeout(function(){d.addBehavior(e)},500),this},Actor.prototype.setNextBackgroundLoop=function(a){return this.nextBackgroundLoop=a,this},Actor.prototype.playsBackground=function(a,b,c){var d=this;this.backgroundPlayer=!0;var e=new Playing(d,a,b,!0,!0,c);return setTimeout(function(){d.addBehavior(e)},100),this},Actor.prototype.playsAndPulsates=function(a,b){var c=this,d=new Playing(c,a,b);return c.pulsatesWhilePlaying=!0,setTimeout(function(){c.addBehavior(d)},100),this},Scene.prototype.mute=function(){for(var a=0;a<this.actors.length;a++)try{this.actors[a].pauseAudio()}catch(b){}},Scene.prototype.muteNonBackground=function(){for(var a=0;a<this.actors.length;a++)try{"undefined"!=typeof this.soloPlayer&&this.soloPlayer||"undefined"!=typeof this.actors[a].backgroundPlayer&&this.actors[a].backgroundPlayer||this.actors[a].pauseAudio(!1)}catch(b){}},Scene.prototype.muteOthers=function(){for(var a=this,b=a.animation.loadedScenes.length-1;b>=0;b--)a.animation.loadedScenes[b].id.match(this.id)||a.animation.loadedScenes[b].mute()},Actor.prototype.stopsPlaying=function(a,b){new StopPlaying(this,a,b);return this},Actor.prototype.letsStopPlaying=function(a){return console.log("TARGET: "+a.filename),this.reacts("this.stopsPlaying(true, reactionTargetIndex);",1,a),this},Actor.prototype.startsPlaying=function(a,b){new StartsPlaying(this,a,b);return this},Actor.prototype.letsStartPlaying=function(a){return this.reacts("this.startsPlaying(true, reactionTargetIndex);",1,a),this},Actor.prototype.drifts=function(a,b,c,d){return this.addBehavior(new Drifting(this,a,b,c,d)),this},Actor.prototype.driftsOnTouch=function(a,b){return this.reacts("this.drifts("+a+","+b+", true, reactionTargetIndex);",1),this},Actor.prototype.letsDrift=function(a,b,c){return this.reacts("this.drifts("+b+","+c+", true, reactionTargetIndex);",1,a),this},Actor.prototype.shakes=function(a,b,c,d,e){return this.addBehavior(new Shaking(this,a,b,c,d,e)),this},Actor.prototype.shakesOnTouch=function(a,b,c,d){return d="undefined"==typeof d?1:d,this.reacts("this.shakes("+a+","+b+","+c+");",d),this},Actor.prototype.letsShake=function(a,b,c,d,e){return e="undefined"==typeof e?1:e,this.reacts("this.shakes("+b+","+c+","+d+", true, reactionTargetIndex  );",e,a),this},Actor.prototype.links=function(a,b){return"undefined"!=typeof b&&(b="_blank"),this.addClass("reacts"),this.addBehavior(new Linking(this,a,b)),this},Actor.prototype.linksToNewWindow=function(a){return this.addBehavior(new Linking(this,a,"_blank")),this.addClass("reacts"),this},Actor.prototype.linksToSameWindow=function(a){return this.addBehavior(new Linking(this,a,"_self")),this.addClass("reacts"),this},Actor.prototype.triggerResetReactions=function(a,b){return this.reactionTargets[b].resetReactions(),this.reactionTargets[b].removeBehaviorsThatCameFromReacts(),this},Actor.prototype.letsResetReactions=function(a){return this.reacts("this.triggerResetReactions(true, reactionTargetIndex)",1,a),this},Actor.prototype.triggerResetBehaviors=function(a,b){return this.reactionTargets[b].resetBehaviors(),this},Actor.prototype.letsResetBehaviors=function(a){return this.reacts("this.triggerResetBehaviors(true, reactionTargetIndex)",1,a),this},Actor.prototype.toggle=function(){return this.scene.textDisplaying?(this.image.src="images/"+this.textToggleAlternativeImagePath,this.scene.hideText()):(this.image.src="images/"+this.image.originalPath,this.scene.showText()),this},Actor.prototype.togglesTextOnTouch=function(a){return this.textToggleAlternativeImagePath=a,this.reacts("this.toggle();"),this},Actor.prototype.passesTouchThrough=function(){return this.passesTouchThroughSet=!0,this.image.style.pointerEvents="none",this},Actor.prototype.clonesMovement=function(a,b,c,d,e){return this.addBehavior(new MovementCloning(this,a,b,c,d,e)),this},Actor.prototype.initializeCounterIfNeeded=function(a){console.log("initializing counter "+this.filename),"undefined"==typeof this.counterInitialized&&(this.addBehavior(new CountResetter(this)),"undefined"!=typeof a&&(this.counterInitialAmount=a),this.syncs()?(this.counter=parseInt(keyOr(this.synckey+"-counter",AnimationIO.helper.integerValueOfOr(a||0)),10),console.log("got value: "+this.counter)):this.counter=AnimationIO.helper.integerValueOfOr(a||0),this.counterInitialized=!0,this.onMinimumReactions=[],this.onExactReactions=[])},Actor.prototype.actOnReactions=function(){for(var a=0;a<this.onMinimumReactions.length;a++)this.counter>=this.onMinimumReactions[a][0]&&this.onMinimumReactions[a][1]();for(var b=0;b<this.onExactReactions.length;b++)this.counter===this.onExactReactions[b][0]&&this.onExactReactions[b][1]()},Actor.prototype.reactOnMinimum=function(a,b){this.onMinimumReactions.push([a,b])},Actor.prototype.reactOnEqual=function(a,b){this.onExactReactions.push([a,b])},Actor.prototype.autosetCountertext=function(){return"undefined"!=typeof this.textDiv&&this.originalText.indexOf("%count%")>=0?this.setText(this.originalText.replace("%count%",this.counter)):this.setText(this.counter),this.syncs&&updateKey(this.synckey+"-counter",this.counter),this},Actor.prototype.addsToCounter=function(a,b,c){console.log("adding to counter");var d=b?this.reactionTargets[c]:this;return d.counter=parseInt(d.counter,10)+a,d.autosetCountertext(),d.actOnReactions(),this},Actor.prototype.letsAddToCounter=function(a,b,c){return"undefined"==typeof c&&(c=0),a.initializeCounterIfNeeded(),this.reacts("this.addsToCounter("+b+", true, reactionTargetIndex);",c,a),this},Actor.prototype.multipliesCounter=function(a,b,c){var d=b?this.reactionTargets[c]:this;return d.counter=parseInt(d.counter,10)*a,d.autosetCountertext(),this},Actor.prototype.letsMultiply=function(a,b){return a.initializeCounterIfNeeded(),this.reacts("this.multipliesCounter("+b+", true, reactionTargetIndex);",0,a),this},Actor.prototype.setText=function(a,b,c,d,e){return"undefined"==typeof this.textDiv?this.addBehavior(new HavingText(this,a,b,c,d,e)):this.textDivInner.innerHTML=a,this},Actor.prototype.multichoices=function(a,b){return this.addBehavior(new Multichoicing(this,a,b)),this},Actor.prototype.isQuestion=function(a,b,c,d,e,f,g,h){this.rightanswers=a,this.wronganswers=b,c.setInvisible();for(var i=a.length-1;i>=0;i--){h?a[i].letsAppear(c,1):a[i].letsAppearAsQuestion(c,1),a[i].letsChangeImageSrc(this,d),a[i].plays(f,d),a[i].letsChangeImageSrc(a[i],d),a[i].setInvisible();for(var j=b.length-1;j>=0;j--)a[j].letsDissolve(b[j])}for(var k=b.length-1;k>=0;k--)b[k].setInvisible();for(var l=b.length-1;l>=0;l--)b[l].letsChangeImageSrc(b[l],e),b[l].plays(g,e)},Actor.prototype.isLastQuestion=function(a,b,c,d,e,f,g){return this.isQuestion(a,b,c,d,e,f,g,!0),this},Actor.prototype.appearsAsQuestion=function(a,b){return this.addBehavior(new AppearingAsQuestion(this,a,b)),this},Actor.prototype.letsAppearAsQuestion=function(a){return this.reacts("this.appearsAsQuestion(true, reactionTargetIndex);",1,a),this},Actor.prototype.changesImageSrc=function(a,b,c){this.addBehavior(new ChangingImageSrc(this,a,b,c))},Actor.prototype.changesImageSrcOnTouch=function(a){this.reacts("this.changesImageSrc('"+a+"', true, reactionTargetIndex);",1)},Actor.prototype.letsChangeImageSrc=function(a,b){this.reacts("this.changesImageSrc('"+b+"', true, reactionTargetIndex);",1,a)},Actor.prototype.circles=function(a,b,c,d){this.addBehavior(new Circling(this,a,b,!1,c,d))},Actor.prototype.circlesWithTilt=function(a,b,c,d){this.addBehavior(new Circling(this,a,b,!0,c,d))},Actor.prototype.hasPopup=function(a,b,c,d,e,f,g,h){return this.addBehavior(new Popup(this,a,b,c,d,e,f,g,h)),this},Actor.prototype.hasPopupOnTouch=function(a,b,c,d,e,f){return this.reacts("this.hasPopup('"+a+"', "+b+", "+c+", "+d+", "+e+", "+f+", true, reactionTargetIndex);",0),this},Actor.prototype.bounces=function(a,b,c,d,e,f){return this.addBehavior(new Bouncing(this,a,b,c,d,e,f)),this},Actor.prototype.bouncesOnTouch=function(a,b,c,d,e){return e="undefined"!=typeof e?e:0,this.reacts("this.bounces("+a+","+b+","+c+","+d+", true, reactionTargetIndex);",e),this},Actor.prototype.letsBounce=function(a,b,c,d,e){return this.reacts("this.bounces("+b+","+c+","+d+","+e+", true, reactionTargetIndex);",1,a),this},Actor.prototype.triggerOnEvent=function(a,b){bindEvent(this.image,b,function(){a.react()})},Actor.prototype.playvideo=function(a,b,c,d,e){var f=new PlayVideo(this,a,b,c,d,e);return"undefined"!=typeof d&&(f.triggeredByAction=d),this.addBehavior(f),this},Actor.prototype.playvideoOnTouch=function(a,b,c){return this.reacts("this.playvideo("+a+","+b+", "+c+", true, reactionTargetIndex);",1),this},Actor.prototype.letsPlayvideo=function(a,b,c,d){return this.reacts("this.playvideo("+b+","+c+", "+d+", true, reactionTargetIndex);",1,a),this},Actor.prototype.pausevideo=function(a,b,c){var d=new PauseVideo(this,a,b,c);return"undefined"!=typeof b&&(d.triggeredByAction=b),this.addBehavior(d),this},Actor.prototype.pausevideoOnTouch=function(a){return this.reacts("this.pausevideo("+a+", true, reactionTargetIndex);",1),this},Actor.prototype.letsPausevideo=function(a,b){return this.reacts("this.pausevideo("+b+", true, reactionTargetIndex);",1,a),this},Actor.prototype.playvimeo=function(a,b){var c=new PlayVimeo(this,a,b);return"undefined"!=typeof a&&(c.triggeredByAction=a),this.addBehavior(c),this},Actor.prototype.playvimeoOnTouch=function(){return this.reacts("this.playvimeo(true, reactionTargetIndex);",0),this},Actor.prototype.letsPlayvimeo=function(a){return this.reacts("this.playvimeo(true, reactionTargetIndex);",0,a),this},Actor.prototype.pausevimeo=function(a,b){var c=new PauseVimeo(this,a,b);return"undefined"!=typeof a&&(c.triggeredByAction=a),this.addBehavior(c),this},Actor.prototype.pausevimeoOnTouch=function(){return this.reacts("this.pausevimeo(true, reactionTargetIndex);",0),this},Actor.prototype.letsPausevimeo=function(a){return this.reacts("this.pausevimeo(true, reactionTargetIndex);",0,a),this},Actor.prototype.scrollPopUp=function(a,b,c,d){c="undefined"==typeof c?!1:c;var e=new ScrollPopUp(this,a,b,c,d);return this.addBehavior(e),this},Actor.prototype.letsScrollPopUpOnTouch=function(a,b,c){return this.reacts("this.scrollPopUp("+b+","+c+", true, reactionTargetIndex);",0,a),this},Actor.prototype.scrollText=function(a,b,c,d){c="undefined"==typeof c?!1:c;var e=new ScrollText(this,a,b,c,d);return this.addBehavior(e),this},Actor.prototype.letsScrollTextOnTouch=function(a,b,c){return this.reacts("this.scrollText("+b+","+c+", true, reactionTargetIndex);",0,a),this},Actor.prototype.hideObject=function(a,b,c,d){c="undefined"==typeof c?!1:c;var e=new HideObject(this,a,b,c,d);return this.addBehavior(e),this},Actor.prototype.hideObjectOnTouch=function(a,b,c){return this.reacts("this.hideObject("+b+","+c+", true, reactionTargetIndex);",0,a),this},Actor.prototype.stops=function(a,b,c){var d=new Stopping(this,a,b,c);return this.addBehavior(d),d},Actor.prototype.letsStop=function(a,b){return this.reacts("this.stops('"+b+"', true, reactionTargetIndex)",0,a),this},Actor.prototype.stopsOnTouch=function(a){return this.reacts("this.stops('"+a+"', true, reactionTargetIndex)",0),this},Actor.prototype.cranks=function(a,b,c,d,e,f,g,h){return this.crankdirection="undefined"==typeof this.crankdirection||"clockwise"!==this.crankdirection?"clockwise":"counterclockwise",f&&(this.crankEndfunctions=f),"function"==typeof this.crankEndfunctions&&(this.crankEndfunctions=[this.crankEndfunctions]),this.addBehavior(new Cranking(this,a,b,c,d,e,g,h)),this},Actor.prototype.cranksOnTouch=function(a,b,c,d,e,f){return f&&(this.crankEndfunctions=f),this.reacts("this.cranks("+a+", "+b+", "+c+", "+d+", "+e+", false, true, reactionTargetIndex);",1),this},Actor.prototype.addCrankEndFunction=function(a){"undefined"==typeof this.crankEndfunctions?this.crankEndfunctions=[a]:"function"==typeof this.crankEndfunctions?this.crankEndfunctions=[this.crankEndfunctions,a]:this.crankEndfunctions.push(a)},AnimationIO.Game=function(){var a=this;a.seconds=-1,a.movement=setInterval(function(){a.moveClockAndExecuteTimeTriggers()},1e3),a.timeTriggers=[],a.paused=!0,a.addTimeTriggerAt=function(b,c){"undefined"==typeof c.length&&(c=[c]),_.each(c,function(c){c=Math.round(c),c<=a.seconds||("undefined"==typeof a.timeTriggers[c]&&(a.timeTriggers[c]=[]),a.timeTriggers[c].push(b))})},a.pause=function(){a.paused=!0},a.start=function(){a.paused=!1,a.moveClockAndExecuteTimeTriggers()},a.restart=function(){a.paused=!1},a.functionsToExecuteEverySeconds=[],a.executeEverySecond=function(b){a.functionsToExecuteEverySeconds.push(b)},a.moveClockAndExecuteTimeTriggers=function(){if(!a.paused&&(this.currentSeconds=++a.seconds,_.each(a.functionsToExecuteEverySeconds,function(a){a()}),"undefined"!=typeof a.timeTriggers[this.currentSeconds])){for(var b=0;b<a.timeTriggers[this.currentSeconds].length;b++)a.timeTriggers[this.currentSeconds][b]();delete a.timeTriggers[this.currentSeconds]}},this.counters={},this.createCounter=function(a){if("undefined"!=typeof this.counters[a])throw"Counter "+a+"already exists.";return this.counters[a]=new this.Counter}},AnimationIO.Game.prototype.initFunctions=[],AnimationIO.Game.prototype.init=function(){for(var a=0;a<this.initFunctions.length;a++)this.initFunctions[a]();return this},AnimationIO.Game.prototype.Counter=function(){var a=this;a.points=0,a.pointTriggers=[],a.addPoints=function(b){return a.points+=Math.round(b),a.points=a.points<0?0:a.points,a.executePointTriggers(),a.points},a.setPoints=function(b){return a.points=Math.round(b),a.points=a.points<0?0:a.points,a.executePointTriggers(),a.points},a.subtractPoints=function(b){return a.points-=Math.round(b),a.points=a.points<0?0:a.points,a.executePointTriggers(),a.points},a.addPointTriggerAt=function(b,c){"undefined"==typeof a.pointTriggers[c]&&(a.pointTriggers[c]=[]),a.pointTriggers[c].push(b)},a.executePointTriggers=function(){for(var b=0;b<=Math.min(a.points,a.pointTriggers.length);b++)if("undefined"!=typeof a.pointTriggers[b]){for(var c=0;c<a.pointTriggers[b].length;c++)a.pointTriggers[b][c]();delete a.pointTriggers[b]}}};
//# sourceMappingURL=/engine/animation-map.js